(function(){var AcCyclic,AcDelete,AcInsert,Action,Builder,Const,ConstColor,DC,HtmlKeyboard,LayoutVisitor,MathWIMCanvas,NfAbsolute,NfBothSideContainer,NfBottomFormula,NfCharcter,NfCombination,NfContainer,NfCos,NfEOC,NfFraction,NfIntegral,NfLimit,NfLogarithm,NfMain,NfMultiContainer,NfPart,NfProbability,NfRemainderSetContainer,NfRepeatedCombination,NfRoot,NfSigma,NfSin,NfTan,NfUpperBottomFormula,NfUpperFormula,NfVector,Parser,agent,append_api_to_canvas,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};agent=navigator.userAgent,-1!==agent.search(/Android/)&&(window.android=!0),window.tablet=-1!==agent.search(/iPhone/)||-1!==agent.search(/iPad/)||-1!==agent.search(/iPod/)||-1!==agent.search(/Android/)?!0:!1,window.document.write(window.android?"<style>\n@font-face {\n    font-family: integral-symbol;  /* フォントにフォント集合名を付ける */\n    src: url('data:application/x-font-woff;charset=utf-8;base64,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') format('woff');\n}\n@font-face {\n    font-family: sigma-symbol;  /* フォントにフォント集合名を付ける */\n    src: url('data:application/x-font-woff;charset=utf-8;base64,d09GRk9UVE8AAAUEAA0AAAAABrwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABDRkYgAAABMAAAAYEAAAGghFmYdkZGVE0AAAK0AAAAGgAAABxqpPLUR0RFRgAAAtAAAAAbAAAAIAAvAARPUy8yAAAC7AAAAEkAAABgXYBl3WNtYXAAAAM4AAAAOQAAAUoHV/8UaGVhZAAAA3QAAAAtAAAANgGNlOtoaGVhAAADpAAAABoAAAAkCEMD62htdHgAAAPAAAAACAAAAAgH0AB8bWF4cAAAA8gAAAAGAAAABgACUABuYW1lAAAD0AAAAPoAAAGeoxKP2XBvc3QAAATMAAAAEAAAACAAAwABdmhlYQAABNwAAAAfAAAAJAZSCsJ2bXR4AAAE/AAAAAgAAAAIALQD3HicNY8xSFtRGIXPTV40TUJqooHEPktAoQ4tBCKlQ4dQMnTVyYJTB12MpkYxlSeEKBi9LbQls106pFNTEFS04ODgIBSKiEoQaRx0cemQ+Ehz/N/gHT4+fu495/4KhgGl1IPx6anZZCL5HMoFhWdN09XsczejxoeA0gG3Dhha25Zd9piYemgCXSbehUwETfUlDLfzxIcwHteLm/Vitb60fh+XyU7O5eK595m305MA1ApczmW/imnDLttWu9wZJKxR0F2LI0LXSRSa6JYB/ReCywNoD9mqFIjE0D7Z+DtKDJy2yH99g0RsNSVmHoqVjsibNydEuJglrz+PEf7ZXccMx9JkLdMiPDsF8vcwKP956WV7oySN6kkVbC+XBD8KgpkKqLJbTjde/YlTToNIdtcI36+PRP+IZEYWLLHhb45NEL2LL4intZ9E6PsAkU5deYlHCVni9pPgOC+5Z3n8X9KyYWxPCua2BNtema+9FjtPwRO0rR4dmf9qZ3WHDvjuAHWQsmUAAAB4nGNgYGBkAIIztovOg+jzxiuYYDQARX0F1AAAeJxjYGRgYOADYgkGEGBiYIRCFjCPAQAEVQA0AHicY2BmfsE4gYGVgYOpi2kPAwNDD4RmfMBgyMjEwMDEwMrJAAMNDEggIM01hcGBeTEQKvy3YIhigQgzQijmOwwKQMgIAIWwDBYAAAB4nGNgYGBmgGAZBkYGEHAB8hjBfBYGDSDNBqQZGZiAihb//w9SAKH/xEHVAwEjGwOCM0IBACbbB2wAAAB4nGNgZGBgAGKfd0E/4/ltvjJoM78AijCcN17BjEwzv2ABURwMTCAKADePCZAAAAB4nGNgZGBgYQCCKOYXIApIMjKgAiYAMsICOQAAA+gAAAPoAHwAAFAAAAIAAHicfY89TsNAEIU/J04AgRAVQlRbIFHZWq+RkdLQRdQU6RPJsSL5J7LjIkfgAhyDM9ByDA7AGeA52jQUrDQ737x9M7sLXPBGwLAC8a3nESc8eh5zx6vnkFM+PE8458vzVPqPnEF4JuXm0DXwiEvuPY955slzyBXvnidc8+l5Kv2bii0lPR1GsVe9opFCtS37znT7atWoeiGnkK1kSasyL/pyKZjLXLM75FaOXGMcMVZ5plj781RKSuZVJ4q0D2FJeNCgpt7Nm7bIjYutmZm16tSmmdBlkYucTeT6O46jDRa6u9UXNgeL0dThFSzytts0tUli+1/7LycWO/MAAHicY2BmQAaMDGgAAACOAAV4nGNgFGBg/PKPhyEKCBn+RLEwAAEjAzJgAgBu5gQiAABaAAAAWgPc') format('woff');\n}\n@font-face {\n    font-family: root-symbol;  /* フォントにフォント集合名を付ける */\n    src: url('data:application/x-font-woff;charset=utf-8;base64,d09GRk9UVE8AAAYAAA0AAAAACEAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABDRkYgAAABMAAAApAAAAMs0rkHykZGVE0AAAPAAAAAGgAAABxq1hlER0RFRgAAA9wAAAAbAAAAIAAvAARPUy8yAAAD+AAAAEYAAABgeCWEh2NtYXAAAARAAAAAPQAAAUpERuCdaGVhZAAABIAAAAAqAAAANgHBu3FoaGVhAAAErAAAABsAAAAkCEgEA2htdHgAAATIAAAACAAAAAgIAAARbWF4cAAABNAAAAAGAAAABgACUABuYW1lAAAE2AAAAPAAAAGVimOx/XBvc3QAAAXIAAAAEAAAACAAAwABdmhlYQAABdgAAAAgAAAAJAZLCrZ2bXR4AAAF+AAAAAgAAAAIALQDuXicRVFdSJNhGH2+7ZvObWozFaEVKgslhDaFwpCgsgS1HDi8EJlSMEMqRU1ElKQfCj+DLkZQCJYUSBoGmWT+3UQU1KhY0Y9aiNGwQWRla+lOZxfZzeG8z3Oen/O8iqiqKIqS4G080VrgcBSKohNF9oRtuvBmfThD7bUomkWvWdQtJkloq9quaevEEq9pke6Iz2CTjmSbyAabdFltYrTp7Smij7UxSKKkNzc2tv7rXllVcoA00ykiynnRxURmXb+mRnyRzqgvPgn68aAQXJIG2XG4CCLWh8Avax+AChdEGc0Fop4QRJcnwFrITYmb7LfdrgGBkQvEF32DlD/9AaxWqhSVGQmDboKLsbXbx4AvyXzipQ8wzUyyxPNtlHh5YhejzRZCSwphK+XoZncUkr29xppDm2Y5oH8YyKl2GNdpPtNZV4GDhjPcb/4BxwTLCDc7gT83CoHIwAATA8uMVSxA9Bmv+IxO01GuF3j/yAypD1fSwcROSNfnEsDvGYFcauD0hZxnEPdghBXXz9Lv/jgyfxNZUR4QDNUBP2drgMU1B/C9tj3GnDHWwewixSsmHiQ6/YQVJ+eN/ymNOTu4wozwWTJFNpRNNjIOUdN3Q4bMQcjwkJfXDtRS3FZDSa2HbIpfY/AtAcv1qZB47T6w1HIHEjf1AQjNdEPM3n7goz2T2YLTjLnrINZV6vxzK5Dke2rsdo8hpvli+l/ey37GVOBrBXdR35Wyc3Y+d/nEs2HMb+QKPdWkjlFIutIDOT6ng2QV2yB3b5VCcsaZeH0xD5LonIXsCxB0vbyR7lyY0NRKaCiGbHTHHJYvQnCkgW7a30CujE0ytvAc4upjmZyizW3lR8kSA8akiC9VS9Mspr+047QmeJxjYGBgZACCM7aLzoPo8z7WVjAaAEPvBZwAAHicY2BkYGDgA2IJBhBgYmCEQhYwjwEABFUANAB4nGNgZmFgnMDAysDBNJPpDAMDQz+EZnzNYMzIycDAxMAKJJGAA4wRkOaawuCgJKUkxWz835ghhgUizAhXqQCEjAAguQmhAAB4nGNgYGBmgGAZBkYGEHAB8hjBfBYGDSDNBqQZGZgYGJSk/v8HKYDQd59D1QMBIxsDgjN0AUVeAACuqgcDAAAAeJxjYGRgYABiQ7vePfH8Nl8ZtFkYQOC8j7UVMs38GizOwcAEogDuggelAAB4nGNgZGBgYQCCGDDJwPyagZEBFTABAByjAVcABAAAAAQAABEAAFAAAAIAAHicfY9PSsNAFMZ/adNqUUREXMos3CZMErG0B0hdW8i+i2kolATSdu8pvIFncOsxPIBncO2X8rpx4cDwfu+b7/0Z4JI3IvoTMeHWeMAZqfGQB16NY875MB5xwZfxWPqPnFE8kXJzrOp5wBX3xkOeeTKOuebdeMQdn8Zj6d8sqVhQ0tKwx5HBslqUbbN3whcCNQe2rOiUhvqwXQlO/j52cgRV5vqFV5zrru29kOKZmZoxJZGWyOuVPaqRBpVtVweXp97N3Vp54f1MmE2TIsl9JtffdpxsaPugDXZsjpZ+Rr8FVeh2m7ZxWer/K/8FXm43bnicY2BmQAaMDGgAAACOAAV4nGNgFGBgfP2PgSGGIYqB4U8UCwMQMDIgAyYAbKkEDwBaAAAAWgO5') format('woff');\n}\n</style>":"<style>\n@font-face {\n    font-family: integral-symbol;  /* フォントにフォント集合名を付ける */\n    src: url('data:font/ttf;base64,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') format('truetype');\n}\n@font-face {\n    font-family: sigma-symbol;  /* フォントにフォント集合名を付ける */\n    src: url('data:font/ttf;base64,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') format('truetype');\n}\n@font-face {\n    font-family: root-symbol;  /* フォントにフォント集合名を付ける */\n    src: url('data:font/ttf;base64,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') format('truetype');\n}\n</style>"),window.document.write("<style>\n/* style for Popup */\n#_excalc_toast_wrapper {\n  visibility: hidden;\n  z-index: 999;\n  text-align: center;\n  position: fixed;\n  top: 50%;\n  left: 0;\n  width: 100%;\n}\n#_excalc_toast {\n  visibility: hidden;\n  z-index: 999;\n  background-color: rgba(0,0,0,0.8);\n  color: white;\n  padding:12px;\n  box-shadow: 0 0 10px rgba(0,0,0,0.5);\n  margin: 0 auto;\n  width: 100px;\n}\n</style>"),this.MathWIM=function(){function MathWIM(){}return MathWIM.OnHtmlReloaded=function(){var html_object,_i,_j,_len,_len1,_ref,_ref1,_results;for(_ref=document.getElementsByClassName("MathWIM.Disp"),_i=0,_len=_ref.length;_len>_i;_i++)html_object=_ref[_i],append_api_to_canvas(html_object);for(_ref1=document.getElementsByClassName("MathWIM"),_results=[],_j=0,_len1=_ref1.length;_len1>_j;_j++)html_object=_ref1[_j],_results.push(append_api_to_canvas(html_object));return _results},MathWIM}(),window.addEventListener("load",function(){var element;return HtmlKeyEvent.setup_html_events(),HtmlKeyboard.init_keyboard(),element=document.createElement("div"),element.innerHTML='<div id="_excalc_toast_wrapper"><p id="_excalc_toast"></p></div>',document.getElementsByTagName("body").item(0).insertBefore(element,null),element=document.createElement("div"),element.id="webfont_load",element.style.fontFamily="integral-symbol, sigma-symbol",element.style.fontSize="45pt",element.innerHTML="wait for web font load. ∫∑",element.style.visibility="hidden",document.getElementsByTagName("body").item(0).insertBefore(element,null),window.tablet?document.addEventListener("touchend",FocusManager.on_body_mousedown):document.addEventListener("mousedown",FocusManager.on_body_mousedown),setTimeout(function(){return MathWIM.OnHtmlReloaded(),window.setInterval(FocusManager.carret_blink,1e3),null!=window.test_ready_callback?window.test_ready_callback():void 0},500)}),append_api_to_canvas=function(html_object){var o;if(!html_object._MathWIMCanvas){for(html_object._MathWIMCanvas=new MathWIMCanvas(html_object),o=html_object.parentNode;null!==o&&"FORM"!==o.tagName;)o=o.parentNode;if(null!==o)return o[html_object.id]=html_object}},Builder=function(){function Builder(){}var SStream;return SStream=function(){function SStream(str){this.str=str,this.lest=this.str.length}return SStream.prototype.pop=function(regexp){var r;return(r=this.str.match(regexp))?(this.str=this.str.replace(regexp,""),this.lest=this.str.length,r[0]):null},SStream.prototype.pop_front=function(str){return this.str.substr(0,str.length)===str?(this.str=this.str.substr(str.length,this.str.length-str.length),this.lest=this.str.length,str):null},SStream.prototype.is_front=function(str){return this.str.substr(0,str.length)===str},SStream}(),Builder.build_one=function(dc,stream){var c,find_close,fmt,info,inner_kakko_count,pt,regexp,ret,str,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref,_ref1,_ref2,_ref3,_ref4;for(_ref=Builder.multi_container_build_info_table(),_i=0,_len=_ref.length;_len>_i;_i++)if(info=_ref[_i],str=stream.pop_front(info.fmt)){for(ret=new info.cls(dc),find_close=!1,inner_kakko_count=0,_ref1=ret.get_inner_container_sorted_for_build(),_j=0,_len1=_ref1.length;_len1>_j;_j++){for(c=_ref1[_j];0!==stream.lest;){if(stream.is_front("(")&&(inner_kakko_count+=1),stream.is_front(")")&&(inner_kakko_count-=1,-1===inner_kakko_count)){stream.pop_front(")"),find_close=!0;break}if(null!==stream.pop_front(","))break;pt=this.build_one(dc,stream),null!=pt&&c.push(pt)}if(find_close)break}return ret}for(_ref2=Builder.multi_container_no_kakko_1char_table(),_k=0,_len2=_ref2.length;_len2>_k;_k++)if(info=_ref2[_k],regexp=RegExp("^"+info.fmt.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"([^(])"),str=stream.pop(regexp))return ret=new info.cls(dc),ret.get_inner_container_sorted_for_build()[0].push(new NfCharcter(dc,str[1])),ret;for(_ref3=Builder.multi_container_no_kakko_allchild_table(),_l=0,_len3=_ref3.length;_len3>_l;_l++)if(info=_ref3[_l],str=stream.pop_front(info.fmt)){for(ret=new info.cls(dc),c=ret.get_inner_container_sorted_for_build()[0];0!==stream.lest;)pt=this.build_one(dc,stream),null!=pt&&c.push(pt);return ret}for(_ref4=NfCharcter.fmt_list(),_m=0,_len4=_ref4.length;_len4>_m;_m++)if(fmt=_ref4[_m],str=stream.pop_front(fmt))return ret=new NfCharcter(dc,NfCharcter.fmt_to_char(fmt));return(c=stream.pop(/^./))?" "===c?void 0:new NfCharcter(dc,c):void 0},Builder.build_main=function(ex_calc_canvas,str){var pt,ret,stream;for(stream=new SStream(str),ret=new NfMain(ex_calc_canvas);0!==stream.lest;)pt=this.build_one(ex_calc_canvas.dc,stream),null!=pt&&ret.push(pt);return ret},Builder.get_fomula_prefix=function(o){var info,_i,_len,_ref;for(_ref=this.multi_container_build_info_table(),_i=0,_len=_ref.length;_len>_i;_i++)if(info=_ref[_i],o.constructor===info.cls)return info.fmt},Builder.multi_container_build_info_table=function(){return this._multi_container_build_info_table||(this._multi_container_build_info_table=[{fmt:"@F(",cls:NfFraction},{fmt:"@R(",cls:NfRoot},{fmt:"@S(",cls:NfSin},{fmt:"@C(",cls:NfCos},{fmt:"@T(",cls:NfTan},{fmt:"@I(",cls:NfIntegral},{fmt:"@G(",cls:NfSigma},{fmt:"@L(",cls:NfLimit},{fmt:"@O(",cls:NfLogarithm},{fmt:"@P(",cls:NfProbability},{fmt:"@K(",cls:NfCombination},{fmt:"@H(",cls:NfRepeatedCombination},{fmt:"@A(",cls:NfAbsolute},{fmt:"@V(",cls:NfVector},{fmt:"@B(",cls:NfRemainderSetContainer},{fmt:"^(",cls:NfUpperFormula},{fmt:"_(",cls:NfBottomFormula},{fmt:"|(",cls:NfUpperBottomFormula}])},Builder.multi_container_no_kakko_1char_table=function(){return this._multi_container_no_kakko_1char_table||(this._multi_container_no_kakko_1char_table=[{fmt:"^",cls:NfUpperFormula}])},Builder.multi_container_no_kakko_allchild_table=function(){return this._multi_container_no_kakko_allchild_table||(this._multi_container_no_kakko_allchild_table=[{fmt:"@F",cls:NfFraction},{fmt:"@R",cls:NfRoot},{fmt:"@S",cls:NfSin},{fmt:"@C",cls:NfCos},{fmt:"@T",cls:NfTan},{fmt:"@I",cls:NfIntegral},{fmt:"@G",cls:NfSigma},{fmt:"@L",cls:NfLimit},{fmt:"@O",cls:NfLogarithm},{fmt:"@P",cls:NfProbability},{fmt:"@K",cls:NfCombination},{fmt:"@H",cls:NfRepeatedCombination},{fmt:"@A",cls:NfAbsolute},{fmt:"@V",cls:NfVector},{fmt:"@B",cls:NfRemainderSetContainer},{fmt:"_",cls:NfBottomFormula},{fmt:"|",cls:NfUpperBottomFormula}])},Builder}(),Const=function(){function Const(){}return Const.HIGH_SCHOOL="HIGH_SCHOOL",Const.JUNIOR_HIGH_SCHOOL="JUNIOR_HIGH_SCHOOL",Const}(),ConstColor=function(){function ConstColor(){}return ConstColor.UNDERLINE="#0000FF",ConstColor.EMPTY_CONTAINER="#88FF88",ConstColor}(),this.FocusManager=function(){function FocusManager(){}return FocusManager.canvas_list=[],FocusManager.active_canvas=void 0,FocusManager.on_body_mousedown=function(){return null==FocusManager.clicked&&FocusManager.set_active_canvas(void 0),FocusManager.clicked=void 0},FocusManager.on_canvas_mousedown=function(ex_calc_canvas){return"MathWIM"===ex_calc_canvas.canvas_type()?(FocusManager.set_active_canvas(ex_calc_canvas),FocusManager.clicked=ex_calc_canvas):void 0},FocusManager.on_html_key_mousedown=function(html_key_element){return FocusManager.clicked=html_key_element,setTimeout(function(){return FocusManager.clicked=void 0},100)},FocusManager.add_canvas=function(canvas){return FocusManager.canvas_list<<canvas},FocusManager.carret_blink=function(){var _ref,_ref1;return null!=(_ref=FocusManager.active_canvas)&&null!=(_ref1=_ref.carret)?_ref1.blink():void 0},FocusManager.set_active_canvas=function(c){var _ref;return null!=(_ref=FocusManager.active_canvas)&&_ref.carret.lost_focus(),FocusManager.active_canvas=c,c?(FocusManager.active_canvas.carret.draw(),HtmlKeyboard.on_change_active_canvas(FocusManager.active_canvas),HtmlKeyboard.show_keyboard()):HtmlKeyboard.hide_keyboard()},FocusManager.get_active_canvas=function(){return this.active_canvas},FocusManager}.call(this),this.HtmlKeyEvent=function(){function HtmlKeyEvent(){}return HtmlKeyEvent.setup_html_events=function(){return window.document.onkeydown=function(){return HtmlKeyEvent.is_invalide_key(window.event)?!1:!0},window.addEventListener("keydown",HtmlKeyEvent.key_down,!0)},HtmlKeyEvent.is_invalide_key=function(event){if(null==event)return!1;if(null!=FocusManager.get_active_canvas())switch(event.keyCode){case 8:return!0;case 37:return!0;case 39:return!0;case 38:return!0;case 40:return!0}},HtmlKeyEvent.key_down=function(event){var c,canvas,charTable,info,_i,_len;if(canvas=FocusManager.get_active_canvas())if(AcCyclic.cancel_input(),c=HtmlKeyEvent.keyCodeToChar(event.shiftKey,event.keyCode))canvas.do_action(new AcInsert(canvas,new NfCharcter(canvas.dc,c)));else{for(charTable=[{keyCode:187,shift:!0,"char":"＋"},{keyCode:107,shift:!1,"char":"＋",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:189,shift:!1,"char":"－"},{keyCode:109,shift:!1,"char":"－",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:191,shift:!1,"char":"÷"},{keyCode:111,shift:!1,"char":"÷",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:186,shift:!0,"char":"×"},{keyCode:106,shift:!1,"char":"×",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:189,shift:!0,"char":"＝"},{keyCode:188,shift:!1,"char":","},{keyCode:190,shift:!1,"char":"."},{keyCode:110,shift:!1,"char":".",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:56,shift:!0,"char":"("},{keyCode:57,shift:!0,"char":")"},{keyCode:188,shift:!0,"char":"＜"},{keyCode:190,shift:!0,"char":"＞"},{keyCode:219,shift:!0,"char":"{"},{keyCode:221,shift:!0,"char":"}"},{keyCode:219,shift:!1,"char":"["},{keyCode:221,shift:!1,"char":"]"},{keyCode:49,shift:!0,"char":"!"},{keyCode:96,shift:!1,"char":"0",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:97,shift:!1,"char":"1",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:98,shift:!1,"char":"2",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:99,shift:!1,"char":"3",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:100,shift:!1,"char":"4",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:101,shift:!1,"char":"5",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:102,shift:!1,"char":"6",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:103,shift:!1,"char":"7",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:104,shift:!1,"char":"8",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD},{keyCode:105,shift:!1,"char":"9",location:KeyboardEvent.DOM_KEY_LOCATION_NUMPAD}],_i=0,_len=charTable.length;_len>_i;_i++)info=charTable[_i],info.keyCode===event.keyCode&&info.shift===event.shiftKey&&(null==info.location&&event.location===KeyboardEvent.DOM_KEY_LOCATION_STANDARD||info.location===event.location)&&canvas.do_action(new AcInsert(canvas,new NfCharcter(canvas.dc,info.char)));switch(event.keyCode){case 8:canvas.do_action(new AcDelete(canvas,AcDelete.BACKSPACE));break;case 46:canvas.do_action(new AcDelete(canvas,AcDelete.DELETE));break;case 37:canvas.carret.move_left();break;case 39:canvas.carret.move_right();break;case 38:canvas.carret.move_up();break;case 40:canvas.carret.move_down()}}},HtmlKeyEvent.isAlnum=function(v){return this.isDigit(v)||this.isAlpha(v)},HtmlKeyEvent.isDigit=function(v){return v>47&&58>v},HtmlKeyEvent.isAlpha=function(v){return v>=65&&90>=v},HtmlKeyEvent.keyCodeToChar=function(isShiftKey,characterCode){return this.isDigit(characterCode)?isShiftKey?void 0:String.fromCharCode(characterCode):this.isAlpha(characterCode)?isShiftKey?String.fromCharCode(characterCode):String.fromCharCode(characterCode).toLowerCase():void 0},HtmlKeyEvent}.call(this),HtmlKeyboard=function(){function HtmlKeyboard(){}return HtmlKeyboard.init_keyboard=function(){var elem,find,html_element,_i,_len,_ref;for(find=!1,this._keyboard_html_elements=[],_ref=document.getElementsByClassName("MathWIMHtmlKeyboard"),_i=0,_len=_ref.length;_len>_i;_i++)html_element=_ref[_i],html_element.innerHTML=this.keyboard_html,find=!0,this._keyboard_html_elements.push(html_element),this.origin_display=html_element.style.display;return find?(window.android&&(elem=document.getElementById("_key∥"),elem.setAttribute("data-key-type","alpha")),this.init_keyboard_events(),this.keyboard_change_to(Const.HIGH_SCHOOL),this.select_keyboard("_keyboard_high1"),this.hide_keyboard(),this.showed_toast={}):void 0},HtmlKeyboard.hide_keyboard=function(){var elm,_i,_len,_ref,_results;for(_ref=this._keyboard_html_elements,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)elm=_ref[_i],_results.push(elm.style.display="none");return _results},HtmlKeyboard.show_keyboard=function(){var elm,_i,_len,_ref,_results;for(_ref=this._keyboard_html_elements,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)elm=_ref[_i],_results.push(elm.style.display=this.origin_display);return _results},HtmlKeyboard.init_keyboard_events=function(){var elem,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_len5,_len6,_m,_n,_o,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_results,_results1,_this;for(_ref=document.getElementsByClassName("_keyboard_page"),_i=0,_len=_ref.length;_len>_i;_i++)elem=_ref[_i],elem.style.visibility="hidden";if(window.document.getElementById("_keyboard_high1").style.visibility="inherit",HtmlKeyboard.old="_keyboard_high1",window.tablet){for(_ref1=document.getElementsByClassName("_key_change_button"),_j=0,_len1=_ref1.length;_len1>_j;_j++)elem=_ref1[_j],elem.ontouchstart=function(){return event.stopPropagation(),event.preventDefault(),void(this.className+=" userhover useractive")},_this=this,elem.ontouchend=function(event){return this.className=this.className.replace(" userhover useractive",""),FocusManager.on_html_key_mousedown(event),_this.on_key_change_button(event),!1};for(_ref2=document.getElementsByClassName("_keyboard_key"),_k=0,_len2=_ref2.length;_len2>_k;_k++)elem=_ref2[_k],elem.ontouchstart=function(){return event.stopPropagation(),event.preventDefault(),void(this.className+=" userhover useractive")},_this=this,elem.ontouchend=function(event){return FocusManager.on_html_key_mousedown(event),_this.on_keyboard_key(event),this.className=this.className.replace(" userhover useractive",""),!1};for(_ref3=document.getElementsByClassName("_keyboard_page"),_results=[],_l=0,_len3=_ref3.length;_len3>_l;_l++)elem=_ref3[_l],_results.push(elem.ontouchend=function(event){return FocusManager.on_html_key_mousedown(event)});return _results}for(_ref4=document.getElementsByClassName("_key_change_button"),_m=0,_len4=_ref4.length;_len4>_m;_m++)elem=_ref4[_m],elem.onmouseover=function(){return this.className+=" userhover"},elem.onmouseout=function(){return this.className=this.className.replace(" userhover","")},elem.onmousedown=function(event){return event.preventDefault(),event.stopPropagation(),FocusManager.on_html_key_mousedown(event)},elem.onclick=this.on_key_change_button;for(_ref5=document.getElementsByClassName("_keyboard_key"),_n=0,_len5=_ref5.length;_len5>_n;_n++)elem=_ref5[_n],elem.onmouseover=function(){return this.className+=" userhover"},elem.onmouseout=function(){return this.className=this.className.replace(" userhover","")},elem.onmousedown=function(event){return event.preventDefault(),event.stopPropagation(),FocusManager.on_html_key_mousedown(event)},elem.onclick=this.on_keyboard_key;for(_ref6=document.getElementsByClassName("_keyboard_page"),_results1=[],_o=0,_len6=_ref6.length;_len6>_o;_o++)elem=_ref6[_o],_results1.push(elem.onmousedown=function(event){return event.preventDefault(),event.stopPropagation(),FocusManager.on_html_key_mousedown(event)});return _results1},HtmlKeyboard.Alpha=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],HtmlKeyboard.on_keyboard_key=function(event){var c,canvas,elm,into_empty_upper_formula,match,pt,target,_i,_j,_len,_len1,_ref,_ref1,_results,_results1;switch(target=event.target||event.srcElement,canvas=FocusManager.get_active_canvas(),"_keyα"===target.id&&(HtmlKeyboard.showed_toast["_keyα"]||(HtmlKeyboard.showed_toast["_keyα"]=!0,Toast.show("ギリシャ文字 アルファ",1e3))),"_keyβ"===target.id&&(HtmlKeyboard.showed_toast["_keyβ"]||(HtmlKeyboard.showed_toast["_keyβ"]=!0,Toast.show("ギリシャ文字 ベータ",1e3))),"_key( )"===target.id&&(HtmlKeyboard.showed_toast["_key( )"]||(HtmlKeyboard.showed_toast["_key( )"]=!0,Toast.show("()キーを複数回押下すると () -> {} -> [] と切り替わります。",7500))),"_key( )"!==target.id&&AcCyclic.cancel_input(),target.id){case"_keyBS":return canvas.do_action(new AcDelete(canvas,AcDelete.BACKSPACE));case"_keyDel":return canvas.do_action(new AcDelete(canvas,AcDelete.DELETE));case"_keyΣ":return canvas.do_action(new AcInsert(canvas,new NfSigma(canvas.dc))),canvas.carret.move_left().move_left().move_left();case"_keylim":return canvas.do_action(new AcInsert(canvas,new NfLimit(canvas.dc))),canvas.carret.move_left().move_left();case"_keylog":return canvas.do_action(new AcInsert(canvas,new NfLogarithm(canvas.dc))),canvas.carret.move_left().move_left();case"_key∫":return canvas.do_action(new AcInsert(canvas,new NfIntegral(canvas.dc))),canvas.carret.move_left().move_left();case"_key分数":return canvas.do_action(new AcInsert(canvas,new NfFraction(canvas.dc))),canvas.carret.move_left().move_left();case"_key√":return canvas.do_action(new AcInsert(canvas,new NfRoot(canvas.dc))),canvas.carret.move_left();case"_key( )":return canvas.do_action(new AcCyclic(canvas,["(",")","{","}","[","]"]));case"_key左":return canvas.carret.move_left();case"_key右":return canvas.carret.move_right();case"_key大":for(HtmlKeyboard._key_upper=!HtmlKeyboard._key_upper,_ref=HtmlKeyboard.Alpha,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],elm=window.document.getElementById("_key"+c),_results.push(HtmlKeyboard._key_upper?elm.innerHTML=c.toUpperCase():elm.innerHTML=c);
return _results;case"_keysin":return canvas.do_action(new AcInsert(canvas,new NfSin(canvas.dc))),canvas.carret.move_left();case"_keycos":return canvas.do_action(new AcInsert(canvas,new NfCos(canvas.dc))),canvas.carret.move_left();case"_keytan":return canvas.do_action(new AcInsert(canvas,new NfTan(canvas.dc))),canvas.carret.move_left();case"_key絶対値":return canvas.do_action(new AcInsert(canvas,new NfAbsolute(canvas.dc))),canvas.carret.move_left();case"_key累乗":if(pt=canvas.carret.get_part(),into_empty_upper_formula=pt.parent instanceof NfContainer&&pt.parent.is_empty()&&pt.parent.parent instanceof NfUpperFormula,!into_empty_upper_formula)return canvas.do_action(new AcInsert(canvas,new NfUpperFormula(canvas.dc))),canvas.carret.move_left();break;case"_key下付":return canvas.do_action(new AcInsert(canvas,new NfBottomFormula(canvas.dc))),canvas.carret.move_left();case"_key_P_":return canvas.do_action(new AcInsert(canvas,new NfProbability(canvas.dc))),canvas.carret.move_left(),canvas.carret.move_left();case"_key_C_":return canvas.do_action(new AcInsert(canvas,new NfCombination(canvas.dc))),canvas.carret.move_left(),canvas.carret.move_left();case"_key_H_":return canvas.do_action(new AcInsert(canvas,new NfRepeatedCombination(canvas.dc))),canvas.carret.move_left(),canvas.carret.move_left();case"_keyベクトル":return canvas.do_action(new AcInsert(canvas,new NfVector(canvas.dc))),canvas.carret.move_left();case"_key余集合":return canvas.do_action(new AcInsert(canvas,new NfRemainderSetContainer(canvas.dc))),canvas.carret.move_left();default:if(match=target.id.match(/_key(.*)/)){for(_ref1=NfCharcter.char_list(),_results1=[],_j=0,_len1=_ref1.length;_len1>_j;_j++)c=_ref1[_j],_results1.push(c===match[1]?HtmlKeyboard._key_upper&&HtmlKeyboard.Alpha.some(function(alpha){return c===alpha})?canvas.do_action(new AcInsert(canvas,new NfCharcter(canvas.dc,c.toUpperCase()))):canvas.do_action(new AcInsert(canvas,new NfCharcter(canvas.dc,c))):void 0);return _results1}}},HtmlKeyboard.on_key_change_button=function(event){var target,_change_to;return target=event.target||event.srcElement,HtmlKeyboard.school===Const.HIGH_SCHOOL&&(_change_to=function(){switch(target.id){case"_keyboard_high1.next":return"_keyboard_high2";case"_keyboard_high1.prev":return"_keyboard_high4";case"_keyboard_high2.next":return"_keyboard_high3";case"_keyboard_high2.prev":return"_keyboard_high1";case"_keyboard_high3.next":return"_keyboard_high4";case"_keyboard_high3.prev":return"_keyboard_high2";case"_keyboard_high4.next":return"_keyboard_high1";case"_keyboard_high4.prev":return"_keyboard_high3"}}()),HtmlKeyboard.school===Const.JUNIOR_HIGH_SCHOOL&&(_change_to=function(){switch(target.id){case"_keyboard_high1.next":return"_keyboard_high2";case"_keyboard_high1.prev":return"_keyboard_high2";case"_keyboard_high2.next":return"_keyboard_high1";case"_keyboard_high2.prev":return"_keyboard_high1"}}()),HtmlKeyboard.select_keyboard(_change_to)},HtmlKeyboard.select_keyboard=function(_change_to){return null!=this.old&&(document.getElementById(this.old).style.visibility="hidden",document.getElementById(this.old).style.display="none"),document.getElementById(_change_to).style.visibility="inherit",document.getElementById(_change_to).style.display="block",this.old=_change_to},HtmlKeyboard.on_change_active_canvas=function(canvas){return this.keyboard_change_to(canvas.school)},HtmlKeyboard.keyboard_change_to=function(school){return this.school!==school&&("_keyboard_high3"===this.old||"_keyboard_high4"===this.old)&&this.select_keyboard("_keyboard_high1"),this.school=school},HtmlKeyboard}.call(this),Parser=function(){function Parser(){}return Parser.parse_font_setting=function(str_param,default_fonts){var ar,ar2,fonts,i,size,_i,_ref;if(fonts=default_fonts,size=12,void 0!==str_param){if(ar=str_param.split(","),size=parseFloat(ar[1])/10,ar2=["'"+ar[0]+"'"],ar.length>2)for(i=_i=2,_ref=ar.length;_ref>=2?_ref>_i:_i>_ref;i=_ref>=2?++_i:--_i)ar2.push(["'"+ar[i]+"'"]);fonts=ar2.join(",")+","+fonts}return{size:size,fonts:fonts}},Parser}(),this.Toast=function(){function Toast(){}return Toast.show=function(text,ms){var popup;null==ms&&(ms=1e3),popup=document.querySelector("#_excalc_toast"),popup.innerHTML=text,popup.style.visibility="visible",setTimeout(function(){popup.innerHTML="",popup.style.visibility="hidden"},ms)},Toast}(),this.Carret=function(){function Carret(begin_part,dc,ex_canvas){this.dc=dc,this.ex_canvas=ex_canvas,this.drawed=!1,this.part=begin_part}return Carret.prototype.get_container=function(){return this.part.parent},Carret.prototype.get_index=function(){return this.part.index},Carret.prototype.get_part=function(){return this.part},Carret.prototype.get_prev_part=function(){return this.part.prev()},Carret.prototype.blink=function(){return this.draw()},Carret.prototype.draw=function(){var h,lparts,x,y;return this.drawed=!this.drawed,this.ex_canvas.redraw(),this.drawed?(lparts=this.part.prev()||this.part,this.part instanceof NfEOC?(x=this.part.carret_info.x,y=this.part.carret_info.y,h=this.part.carret_info.height):(x=this.part.get_position().x,y=Math.min(lparts.get_position().y,this.part.get_position().y),h=Math.max(lparts.size.y,this.part.size.y)),this.dc.fill_rect(x,y+1,2,h-2,"#000000")):void 0},Carret.prototype.undraw=function(){return this.drawed?this.draw():void 0},Carret.prototype.lost_focus=function(){return this.undraw()},Carret.prototype.right_search=function(part){var idx,pt;return idx=part.parent.index,pt=part.parent.get(idx+1),pt instanceof NfEOC?part.parent instanceof NfMain?pt:right_search(pt):pt},Carret.prototype.move_right=function(){var ct;if(this.part instanceof NfMultiContainer)this.move_to(this.part.get(0).get(0));else if(this.part instanceof NfEOC){if(ct=this.part.parent,ct instanceof NfMain)return;ct.is_innder_container()&&this.move_to(null!=ct.next()?ct.next().get(0):ct.parent.next())}else null!=this.part.next()&&this.move_to(this.part.next());return this},Carret.prototype.move_left=function(){var ct,part;if(0===this.part.index){if(ct=this.part.parent,ct instanceof NfMain)return;ct.is_innder_container()&&this.move_to(null!=ct.prev()?ct.prev().eoc:ct.parent)}else part=this.part.prev(),this.move_to(part instanceof NfMultiContainer?part.get_last().eoc:part);return this},Carret.prototype.move_to=function(part){var _ref,_ref1,_ref2;return part instanceof NfPart?part instanceof NfContainer?(console.log("Carret cant move_to NfContainer"),this):(this.undraw(),this.part.parent&&null!=(_ref=this.part.parent.get_multi_container())&&"function"==typeof _ref.set_has_carret&&_ref.set_has_carret(!1),this.part=part,null!=(_ref1=this.part.parent)&&null!=(_ref2=_ref1.get_multi_container())&&"function"==typeof _ref2.set_has_carret&&_ref2.set_has_carret(!0),this.draw(),this):(console.log("Carret cant move_to not part"),this)},Carret.prototype.move_up=function(){var c,pt;return(pt=this.part.parent.get_multi_container())&&this.move_to((c=pt.get_up_container(this.part.parent))?c.get(0):pt),this},Carret.prototype.move_down=function(){var c,pt;return(pt=this.part.parent.get_multi_container())&&this.move_to((c=pt.get_down_container(this.part.parent))?c.get(0):pt),this},Carret}(),DC=function(){function DC(html_canvas_context){this.html_canvas_context=html_canvas_context,this._fontHeight=0,this._font_set={},this._font_type=DC.OTHER_FONT,this._font_scale=1,this._font_italic=!1}return DC.OTHER_FONT="OTHER_FONT",DC.ALNUM_FONT="ALNUM_FONT",DC.MPLUS_SYMBOL_FONT="MPLUS_SYMBOL_FONT",DC.prototype.get_font_height=function(){return 1.25*this._font_set[this._font_type].size},DC.prototype.get_font_size=function(){return this._font_set[this._font_type].size},DC.prototype.set_font_scale=function(sc){return this._font_scale!==sc?(this._font_scale=sc,this.update_font()):void 0},DC.prototype.set_fontset=function(type,fonts,size){return this._font_set[type]={},this._font_set[type].fonts=fonts,this._font_set[type].size=size,this._font_type===type?this.update_font():void 0},DC.prototype.set_font_italic=function(italic){return this._font_italic!==italic?(this._font_italic=italic,this.update_font()):void 0},DC.prototype.select_fonttype=function(type){return this._font_type!==type?(this._font_type=type,this.update_font()):void 0},DC.prototype.get_current_font_string=function(){var italic;return italic=this._font_italic?"italic ":"",""+italic+this._font_set[this._font_type].size*this._font_scale*1.25+"px "+this._font_set[this._font_type].fonts},DC.prototype.update_font=function(){return this.html_canvas_context.font=this.get_current_font_string()},DC.prototype.reset_font=function(part){return this.set_font_scale(part.get_font_scale())},DC.prototype.get_font=function(){return this.get_current_font_string()},DC.prototype.draw_text=function(str,x,y){return this.html_canvas_context.fillText(str,x,y)},DC.prototype.set_line_width=function(l){return this.html_canvas_context.lineWidth=l},DC.prototype.set_line_color=function(color,fn){var v;return null!=fn&&(v=this.html_canvas_context.strokeStyle),this.html_canvas_context.strokeStyle=color,null!=fn&&(fn(),this.html_canvas_context.strokeStyle=v),this},DC.prototype.draw_rect=function(l,t,w,h){return l=Math.ceil(l)-.5,t=Math.ceil(t)-.5,this.html_canvas_context.beginPath(),this.html_canvas_context.strokeRect(l,t,w,h),this.html_canvas_context.stroke()},DC.prototype.draw_rect_color=function(l,t,w,h,color){var v;return l=Math.ceil(l)-.5,t=Math.ceil(t)-.5,v=this.html_canvas_context.strokeStyle,this.html_canvas_context.strokeStyle=color,this.draw_rect(l,t,w,h),this.html_canvas_context.strokeStyle=v},DC.prototype.draw_line=function(x1,y1,x2,y2){return y1===y2&&(y1=y2=Math.ceil(y1)-.5),x1===x2&&(x1=x2=Math.ceil(x1)-.5),this.html_canvas_context.beginPath(),this.html_canvas_context.moveTo(x1,y1),this.html_canvas_context.lineTo(x2,y2),this.html_canvas_context.stroke()},DC.prototype.draw_line_color=function(x1,y1,x2,y2,color){var v;return y1===y2&&(y1=y2=Math.ceil(y1)-.5),x1===x2&&(x1=x2=Math.ceil(x1)-.5),v=this.html_canvas_context.strokeStyle,this.html_canvas_context.strokeStyle=color,this.html_canvas_context.beginPath(),this.html_canvas_context.moveTo(x1,y1),this.html_canvas_context.lineTo(x2,y2),this.html_canvas_context.stroke(),this.html_canvas_context.strokeStyle=v},DC.prototype.fill_rect_XOR=function(x,y,w,h,color){var t;return x=Math.ceil(x)-.5,y=Math.ceil(y)-.5,t=this.html_canvas_context.globalCompositeOperation,this.html_canvas_context.globalCompositeOperation="xor",this.fill_rect(x,y,w,h,color),this.html_canvas_context.globalCompositeOperation=t},DC.prototype.fill_rect=function(x,y,w,h,color){var v;return x=Math.ceil(x)-.5,y=Math.ceil(y)-.5,v=this.html_canvas_context.fillStyle,this.html_canvas_context.fillStyle=color,this.html_canvas_context.fillRect(x,y,w,h),this.html_canvas_context.fillStyle=v},DC.prototype.clear_rect=function(x,y,w,h){return this.html_canvas_context.clearRect(x,y,w,h)},DC.prototype.fill_path4=function(x1,y1,x2,y2,x3,y3,x4,y4){return this.html_canvas_context.beginPath(),this.html_canvas_context.moveTo(x1,y1),this.html_canvas_context.lineTo(x2,y2),this.html_canvas_context.lineTo(x3,y3),this.html_canvas_context.lineTo(x4,y4),this.html_canvas_context.closePath(),this.html_canvas_context.fill()},DC.prototype.set_text_baseline=function(v){return this.html_canvas_context.textBaseline=v},DC.prototype.measure_char=function(part,char){return null==char&&(char="1"),this.set_font_scale(part.get_font_scale()),this.measure_text(char)},DC.prototype.measure_text=function(str){return this.html_canvas_context.measureText(str).width},DC.prototype.set_line_dash=function(){},DC}(),LayoutVisitor=function(){function LayoutVisitor(){this._x=0,this._y=0}return LayoutVisitor.prototype.move=function(x,y){return this._x+=x,this._y+=y},LayoutVisitor.prototype.move_x=function(x){return this._x+=x},LayoutVisitor.prototype.move_y=function(y){return this._y+=y},LayoutVisitor.prototype.set=function(x,y){return this._x=x,this._y=y},LayoutVisitor.prototype.set_x=function(x){return this._x=x},LayoutVisitor.prototype.set_y=function(y){return this._y=y},LayoutVisitor.prototype.get_position=function(){return{x:this._x,y:this._y}},LayoutVisitor.prototype.x=function(){return this._x},LayoutVisitor.prototype.y=function(){return this._y},LayoutVisitor.prototype.set_char_vcenter=function(y){return this._char_vcenter=y},LayoutVisitor.prototype.get_char_vcenter=function(){return this._char_vcenter},LayoutVisitor.prototype.get_char_vcenter_y=function(){return this._y+this._char_vcenter},LayoutVisitor}(),MathWIMCanvas=function(){function MathWIMCanvas(html_object){var alnumFont,child,first_string,i,name,otherFont,priority,sz,_i,_len,_ref,_this=this;for(this.html_object=html_object,this.html_canvas=window.document.createElement("canvas"),this.html_canvas.tabindex=0,""!==this.html_object.width&&(this.width=this.html_canvas.width=this.html_object.width),""!==this.html_object.height&&(this.height=this.html_canvas.height=this.html_object.height),this.html_object.parentElement.insertBefore(this.html_canvas,this.html_object),FocusManager.add_canvas(this),window.tablet?(this.html_canvas.addEventListener("touchstart",function(event){return _this.mouseDownFunc(event)},!0),this.html_canvas.addEventListener("touchmove",function(event){return _this.mouseMoveFunc(event)},!0),this.html_canvas.addEventListener("touchend",function(event){return _this.mouseUpFunc(event)},!0),this.html_canvas.addEventListener("touchcancel",function(event){return _this.mouseUpFunc(event)},!0)):this.html_canvas.addEventListener("mousedown",function(event){return _this.on_mousedown(event)},!0),i=this.html_object.style.length;i-->0;)name=this.html_object.style[i],this.html_canvas.style.setProperty(name,html_object.style.getPropertyValue(name),priority=html_object.style.getPropertyPriority(name));for(this.html_canvas.style.cursor="text",this.html_canvas_context=this.html_canvas.getContext("2d"),this.dc=new DC(this.html_canvas_context),this.params={},_ref=this.html_object.childNodes,_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],child.nodeType!==Node.TEXT_NODE&&(this.params[child.name]=child.value);this.school=Const.HIGH_SCHOOL,otherFont=Parser.parse_font_setting(this.params.OtherFont,'"MS UI Gothic", "Hiragino Kaku Gothic ProN", "Hiragino Kaku Gothic Pro", "Hiragino Kaku Gothic ProN W3", "ヒラギノ角ゴ Pro W3", "Droid Sans Japanese", "sans-serif"'),alnumFont=Parser.parse_font_setting(this.params.AlnumFont,'"Times New Roman", "SERIF"'),this.dc.set_text_baseline("top"),this.dc.set_fontset(DC.OTHER_FONT,otherFont.fonts,otherFont.size),this.dc.set_fontset(DC.ALNUM_FONT,alnumFont.fonts,alnumFont.size),this.dc.set_fontset(DC.MPLUS_SYMBOL_FONT,["integral-symbol","sigma-symbol","Times New Roman","SERIF"],otherFont.size),first_string=this.params.Value,console.log(first_string),(null===first_string||void 0===first_string)&&(first_string=""),void 0!==this.params.BackColor&&(this._background_color=this.params.BackColor,this.html_canvas.style.backgroundColor=this.params.BackColor),this.root=Builder.build_main(this,first_string),this.carret=new Carret(this.root.carret_part(),this.dc,this),this.root.do_layout(),sz=this.root.size,""===this.html_object.width&&(this.html_object.style.width=0,this.width=this.html_canvas.width=sz.x+this.dc.measure_text(" ")),""===this.html_object.height&&(this.html_object.style.height=0,this.height=this.html_canvas.height=sz.y),this.dc.set_text_baseline("top"),this.dc.update_font(),this.redraw(),this.html_object.width=0,this.html_object.height=0}return MathWIMCanvas.prototype.EncodeHTMLForm=function(data){var name,param,params,value;params=[];for(name in data)value=data[name],param=encodeURIComponent(name).replace(/%20/g,"+")+"="+encodeURIComponent(value).replace(/%20/g,"+"),params.push(param);return params.join("&")},MathWIMCanvas.prototype.do_action=function(action){return this.carret.undraw(),action.run(),this.redraw(),this.carret.draw()},MathWIMCanvas.prototype.canvas_type=function(){return this.html_object.className},MathWIMCanvas.prototype.getElementScreenPosition=function(elem){var html,left,rect,top;return html=document.documentElement,rect=elem.getBoundingClientRect(),left=rect.left-html.clientLeft,top=rect.top-html.clientTop,{left:left,top:top}},MathWIMCanvas.prototype.getElementPosition=function(elem){var body,html,left,pos,scrollLeft,scrollTop,top;return html=document.documentElement,body=document.body,scrollLeft=body.scrollLeft||html.scrollLeft,scrollTop=body.scrollTop||html.scrollTop,pos=this.getElementScreenPosition(elem),left=pos.left+scrollLeft,top=pos.top+scrollTop,{left:left,top:top}},MathWIMCanvas.prototype.mouseDownFunc=function(ev){var last_touch,r;return last_touch=ev.targetTouches[0],r=this.getElementPosition(this.html_canvas),this.last_x=ev.offsetX=last_touch.pageX-r.left,this.last_y=ev.offsetY=last_touch.pageY-r.top,!1},MathWIMCanvas.prototype.mouseUpFunc=function(ev){return this._click(this.last_x,this.last_y),ev.preventDefault(),!1},MathWIMCanvas.prototype.mouseMoveFunc=function(ev){var last_touch,r;return last_touch=ev.targetTouches[0],r=this.getElementPosition(this.html_canvas),this.last_x=ev.offsetX=last_touch.pageX-r.left,this.last_y=ev.offsetY=last_touch.pageY-r.top,ev.preventDefault(),this._click(this.last_x,this.last_y),!1},MathWIMCanvas.prototype.on_mousedown=function(event){return this._click(event.offsetX,event.offsetY)},MathWIMCanvas.prototype._click=function(x,y){var part;return FocusManager.on_canvas_mousedown(this),AcCyclic.cancel_input(),"MathWIM"===this.html_object.className&&(part=this.root.get_parts_from_position(x,y),null!=part)?this.carret.move_to(part):void 0},MathWIMCanvas.prototype.clear_rect=function(){return this._background_color?this.dc.fill_rect(0,0,this.html_canvas.width,this.html_canvas.height,this._background_color):this.dc.clear_rect(0,0,this.html_canvas.width,this.html_canvas.height)},MathWIMCanvas.prototype.redraw=function(){return this.clear_rect(),this.root.draw()},MathWIMCanvas}(),NfPart=function(){function NfPart(){this.parent=null,this.size={x:0,y:0,bottom_height:0,top_height:0},this._position={x:0,y:0},this.position=null,this.index=0,this._class=this.constructor.name}return NfPart.prototype.get_font_height=function(){return this.dc.get_font_height()*this.get_font_scale()},NfPart.prototype.get_font_size=function(){return this.dc.get_font_size()*this.get_font_scale()},NfPart.prototype.get_font_scale=function(){var _ref;return null!=this._font_scale?this._font_scale:null!=(_ref=this.parent)?_ref.get_font_scale():void 0},NfPart.prototype.set_font_scale=function(v){return this._font_scale=v},NfPart.prototype.main_part=function(){return null===this.parent?this:this.parent.main_part()},NfPart.prototype.canvas_type=function(){return this.main_part().ex_calc_canvas.canvas_type()},NfPart.prototype.set_parent=function(parent){return this.parent=parent},NfPart.prototype.set_position=function(x,y){return this._position={x:x,y:y}},NfPart.prototype.get_position=function(){return this._position},NfPart.prototype.set_index=function(index){return this.index=index},NfPart.prototype.is_include=function(x,y){return this.get_position().x<=x&&x<=this.get_position().x+this.size.x&&this.get_position().y<=y&&y<=this.get_position().y+this.size.y},NfPart.prototype.is_innder_container=function(){return null!=this._is_innder_container},NfPart.prototype.set_is_innder_container=function(v){return this._is_innder_container=v},NfPart.prototype.next=function(){return this.parent.get(this.index+1)},NfPart.prototype.prev=function(){return 0===this.index?void 0:this.parent.get(this.index-1)},NfPart.prototype.do_layout=function(){return console.log(this._class,"do_layout() not imprement!")},NfPart.prototype.char_vcenter=function(){return 0},NfPart.prototype.get_size_with_char_vcenter=function(){return this.size},NfPart.prototype.set_has_carret=function(b){return this._has_carret=b},NfPart.prototype.has_carret=function(){return this._has_carret},NfPart.prototype["delete"]=function(){return this.parent.remove(this.index)},NfPart.prototype.get_multi_container=function(){return this instanceof NfMultiContainer?this:this instanceof NfMain?void 0:this.parent.get_multi_container()},NfPart}(),NfMultiContainer=function(_super){function NfMultiContainer(){return _ref=NfMultiContainer.__super__.constructor.apply(this,arguments)}return __extends(NfMultiContainer,_super),NfMultiContainer.prototype.set_inner_container=function(){var c,i,_i,_len,_results;for(this._inner_container=arguments,_results=[],i=_i=0,_len=arguments.length;_len>_i;i=++_i)c=arguments[i],c.index=i,c.set_parent(this),_results.push(c.set_is_innder_container(!0));return _results},NfMultiContainer.prototype.has_child=function(){return!0},NfMultiContainer.prototype.set_inner_container_sorted_for_build=function(){return this._inner_container_sorted_for_build=arguments},NfMultiContainer.prototype.each_inner_container_sorted_for_build=function(fn){var c,_i,_len,_ref1,_results;for(_ref1=this._inner_container_sorted_for_build,_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)c=_ref1[_i],_results.push(fn(c));return _results},NfMultiContainer.prototype.get_inner_container_sorted_for_build=function(){return this._inner_container_sorted_for_build},NfMultiContainer.prototype.get=function(index){return this._inner_container[index]},NfMultiContainer.prototype.get_up_container=function(){return void 0},NfMultiContainer.prototype.get_down_container=function(){return void 0},NfMultiContainer.prototype.get_last=function(){return this.get(this._inner_container.length-1)},NfMultiContainer.prototype.on_change_children=function(){return this.update_children(),this.parent?this.parent.on_change_children():void 0},NfMultiContainer.prototype.update_children=function(){var c,_i,_len,_ref1,_results;for(_ref1=this._inner_container,_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)c=_ref1[_i],_results.push(c.update_children());return _results},NfMultiContainer.prototype.carret_part=function(){var c,_i,_len,_ref1;for(_ref1=this._inner_container,_i=0,_len=_ref1.length;_len>_i;_i++)if(c=_ref1[_i],null!=c.carret_part())return c.carret_part()},NfMultiContainer.prototype.draw_focus_box=function(){var bottom,pos;return this.has_carret()?(pos=this.get_position(),this.dc.set_line_width(1),bottom=pos.y+this.size.y+this.size.bottom_height,this.dc.draw_line_color(pos.x,bottom-10,pos.x,bottom,ConstColor.UNDERLINE),this.dc.draw_line_color(pos.x,bottom,pos.x+this.size.x,bottom,ConstColor.UNDERLINE),this.dc.draw_line_color(pos.x+this.size.x,bottom-10,pos.x+this.size.x,bottom,ConstColor.UNDERLINE)):void 0},NfMultiContainer}(NfPart),NfSin=function(_super){function NfSin(dc,type){var ar,c,_i,_len;for(this.dc=dc,this.type=null!=type?type:"sin",NfSin.__super__.constructor.call(this),this.container=new NfContainer(this.dc),this.set_inner_container(this.container),this.set_inner_container_sorted_for_build(this.container),this.symbol=new NfContainer(this.dc),this.symbol.set_parent(this),ar=this.type.split(""),_i=0,_len=ar.length;_len>_i;_i++)c=ar[_i],c=new NfCharcter(this.dc,c),c.italic=!1,this.symbol.push(c)}return __extends(NfSin,_super),NfSin.prototype.draw=function(){return this.container.draw(),this.symbol.draw(),this.draw_focus_box()},NfSin.prototype.char_vcenter=function(){return this.container.char_vcenter()},NfSin.prototype.calc_size=function(){var sz1,sz2;return this.container.calc_size(),this.symbol.calc_size(),sz1=this.symbol.size,sz2=this.container.size,this.size={x:sz1.x+sz2.x,y:Math.max(sz1.y,sz2.y),bottom_height:sz2.bottom_height},this.symbol.calc_size()},NfSin.prototype.do_layout=function(layout_visitor){var pos,vcenter_y;return this.calc_size(),pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.set_position(layout_visitor.x(),vcenter_y-this.char_vcenter()),layout_visitor.set_y(vcenter_y-this.symbol.char_vcenter()),layout_visitor.set_char_vcenter(0),this.symbol.do_layout(layout_visitor),layout_visitor.set_y(vcenter_y-this.container.char_vcenter()),layout_visitor.set_char_vcenter(0),this.container.do_layout(layout_visitor),layout_visitor.set_y(pos.y)},NfSin.prototype.get_parts_from_position=function(x,y){return this.container.get_parts_from_position(x,y)},NfSin}(NfMultiContainer),NfCos=function(_super){function NfCos(dc){this.dc=dc,NfCos.__super__.constructor.call(this,this.dc,"cos")}return __extends(NfCos,_super),NfCos}(NfSin),NfTan=function(_super){function NfTan(dc){this.dc=dc,NfTan.__super__.constructor.call(this,this.dc,"tan")}return __extends(NfTan,_super),NfTan}(NfSin),NfAbsolute=function(_super){function NfAbsolute(dc){this.dc=dc,NfAbsolute.__super__.constructor.call(this),this.container=new NfContainer(this.dc),this.set_inner_container(this.container),this.set_inner_container_sorted_for_build(this.container)}return __extends(NfAbsolute,_super),NfAbsolute.prototype.draw=function(){var pos,x,y,y_to;return this.container.draw(),pos=this.get_position(),x=Math.ceil(pos.x+2),y=Math.ceil(pos.y),y_to=Math.ceil(pos.y+this.container.size.y+this.container.size.bottom_height),this.dc.draw_line_color(x,y,x,y_to,"#000000"),x=Math.ceil(pos.x+2+1+2+this.container.size.x+2),this.dc.draw_line_color(x,y,x,y_to,"#000000"),this.draw_focus_box()},NfAbsolute.prototype.char_vcenter=function(){return this.container.char_vcenter()},NfAbsolute.prototype.calc_size=function(){return this.container.calc_size(),this.size.x=5+this.container.size.x+2+1+2,this.size.y=this.container.size.y,this.size.bottom_height=this.container.size.bottom_height},NfAbsolute.prototype.do_layout=function(layout_visitor){var pos,vcenter_y;return this.calc_size(),pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.set_position(layout_visitor.x(),vcenter_y-this.char_vcenter()),layout_visitor.move_x(5),layout_visitor.set_y(vcenter_y-this.container.char_vcenter()),layout_visitor.set_char_vcenter(0),this.container.do_layout(layout_visitor),layout_visitor.move_x(5),layout_visitor.set_y(pos.y)},NfAbsolute.prototype.get_parts_from_position=function(x,y){return this.container.get_parts_from_position(x,y)},NfAbsolute}(NfMultiContainer),NfBothSideContainer=function(_super){function NfBothSideContainer(dc,center_char){var c,_i,_len;for(this.dc=dc,this.center_char=center_char,NfBothSideContainer.__super__.constructor.call(this),this.left_container=new NfContainer(this.dc),this.right_container=new NfContainer(this.dc),this.set_inner_container(this.left_container,this.right_container),this.set_inner_container_sorted_for_build(this.left_container,this.right_container),this.center_symbol=new NfContainer(this.dc),this.center_symbol.set_parent(this),_i=0,_len=center_char.length;_len>_i;_i++)c=center_char[_i],c=new NfCharcter(this.dc,c),c.italic=!1,this.center_symbol.push(c)}return __extends(NfBothSideContainer,_super),NfBothSideContainer.prototype.draw=function(){return this.center_symbol.draw(),this.left_container.draw(),this.right_container.draw(),this.draw_focus_box()},NfBothSideContainer.prototype.char_vcenter=function(){return this.center_symbol.char_vcenter()},NfBothSideContainer.prototype.calc_size=function(){var max_h,max_y,offset,sc;return sc=.6*this.get_font_scale(),9<this.dc.get_font_size()*sc?(this.left_container.set_font_scale(sc),this.right_container.set_font_scale(sc)):(this.left_container.set_font_scale(9/this.dc.get_font_size()),this.right_container.set_font_scale(9/this.dc.get_font_size())),this.center_symbol.calc_size(),this.left_container.calc_size(),this.right_container.calc_size(),this._top_of_bottom_container=0,offset="P"===this.center_char?-(this.center_symbol.size.x/4):0,this.size.x=this.left_container.size.x+(this.center_symbol.size.x+offset)+this.right_container.size.x,this.size.y=Math.max(this.left_container.size.y+this.char_vcenter()+this._top_of_bottom_container,this.center_symbol.size.y,this.right_container.size.y+this.char_vcenter()+this._top_of_bottom_container),max_y=Math.max(this.left_container.size.y,this.right_container.size.y),max_h=Math.max(this.left_container.size.y+this.left_container.size.bottom_height,this.right_container.size.y+this.right_container.size.bottom_height),this.size.bottom_height=max_h-max_y},NfBothSideContainer.prototype.do_layout=function(layout_visitor){var pos,vcenter_y;return pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.set_position(layout_visitor.x(),vcenter_y-this.get_font_height()/2),layout_visitor.set_x(pos.x),layout_visitor.set_y(vcenter_y+this._top_of_bottom_container),layout_visitor.set_char_vcenter(0),this.left_container.do_layout(layout_visitor),layout_visitor.set_y(vcenter_y-this.center_symbol.char_vcenter()),this.center_symbol.do_layout(layout_visitor),"P"===this.center_char&&layout_visitor.move_x(-(this.center_symbol.size.x/4)),layout_visitor.set_y(vcenter_y+this._top_of_bottom_container),layout_visitor.set_char_vcenter(0),this.right_container.do_layout(layout_visitor),layout_visitor.set_y(pos.y),layout_visitor.set_x(pos.x+this.size.x)},NfBothSideContainer.prototype.get_parts_from_position=function(x,y){var center,left,right;return left=this.left_container.get_position(),right=this.right_container.get_position(),center=this.center_symbol.get_position(),left.x<x?x<center.x?this.left_container.get_parts_from_position(x,y):x<center.x+this.center_symbol.size.x/2?this.left_container.get_parts_from_position(x,y):this.right_container.get_parts_from_position(x,y):void 0},NfBothSideContainer.prototype.get_up_container=function(part){return part===this.right_container?this.left_container:void 0},NfBothSideContainer.prototype.get_down_container=function(part){return part===this.left_container?this.right_container:void 0},NfBothSideContainer}(NfMultiContainer),NfBottomFormula=function(_super){function NfBottomFormula(dc){this.dc=dc,NfBottomFormula.__super__.constructor.call(this),this.bottom=new NfContainer(this.dc),this.set_inner_container(this.bottom),this.set_inner_container_sorted_for_build(this.bottom)}return __extends(NfBottomFormula,_super),NfBottomFormula.prototype.draw=function(){return this.bottom.draw(),this.draw_focus_box()},NfBottomFormula.prototype.char_vcenter=function(){return this.get_font_height()/2},NfBottomFormula.prototype.calc_size=function(){var sc;return sc=.6*this.get_font_scale(),this.bottom.set_font_scale(9<this.dc.get_font_size()*sc?sc:9/this.dc.get_font_size()),this.bottom.calc_size(),this._top_of_bottom_container=0,this.size.x=this.bottom.size.x,this.size.y=this.get_font_height()/2+this._top_of_bottom_container+this.bottom.size.y,this.size.bottom_height=this.bottom.size.bottom_height},NfBottomFormula.prototype.do_layout=function(layout_visitor){var pos,vcenter_y;return this.calc_size(),pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.set_position(layout_visitor.x(),vcenter_y-this.get_font_height()/2),layout_visitor.set_y(vcenter_y+this._top_of_bottom_container),layout_visitor.set_char_vcenter(0),this.bottom.do_layout(layout_visitor),layout_visitor.set_y(pos.y)},NfBottomFormula.prototype.get_parts_from_position=function(x,y){return this.bottom.get_parts_from_position(x,y)},NfBottomFormula}(NfMultiContainer),NfCharcter=function(_super){function NfCharcter(dc,char){switch(this.dc=dc,this.char=char,NfCharcter.__super__.constructor.call(this),!0){case/[0-9]/.test(this.char):this.font_type=DC.ALNUM_FONT,this.italic=!1;break;case/[a-zA-Zαβγθπσ]/.test(this.char):this.font_type=DC.ALNUM_FONT,this.italic=!0;break;case/∥/.test(this.char):window.android?(this.font_type=DC.ALNUM_FONT,this.italic=!0):(this.font_type=DC.OTHER_FONT,this.italic=!1);break;case/[•Σ∫\(\)]/.test(this.char):this.font_type=DC.MPLUS_SYMBOL_FONT,this.italic=!1;break;default:this.font_type=DC.OTHER_FONT,this.italic=!1}}return __extends(NfCharcter,_super),NfCharcter._info_table=[{"char":"•",fmt:"@00"},{"char":"◦",fmt:"@01"},{"char":"→",fmt:"@02"},{"char":"∈",fmt:"@03"},{"char":"∋",fmt:"@04"},{"char":"⊂",fmt:"@05"},{"char":"⊃",fmt:"@06"},{"char":"∩",fmt:"@07"},{"char":"∪",fmt:"@08"},{"char":"∽",fmt:"@09"},{"char":"≡",fmt:"@10"},{"char":"⊥",fmt:"@11"},{"char":"∥",fmt:"@12"},{"char":"：",fmt:"@13"},{"char":"△",fmt:"@80"},{"char":"∠",fmt:"@81"},{"char":"Δ",fmt:"@82"},{"char":"ﾟ",fmt:"@90"},{"char":"´",fmt:"@91"},{"char":"!",fmt:"@92"},{"char":"σ",fmt:"@93"},{"char":"≦",fmt:"<="},{"char":"≠",fmt:"=/"},{"char":"≒",fmt:"=*"},{"char":"≧",fmt:">="},{"char":"±",fmt:"!"},{"char":"π",fmt:"#"},{"char":"θ",fmt:"$"},{"char":"∞",fmt:"%"},{"char":"∅",fmt:"&"},{"char":"(",fmt:"("},{"char":")",fmt:")"},{"char":"×",fmt:"*"},{"char":"＋",fmt:"+"},{"char":",",fmt:","},{"char":"－",fmt:"-"},{"char":".",fmt:"."},{"char":"÷",fmt:"/"},{"char":"0",fmt:"0"},{"char":"1",fmt:"1"},{"char":"2",fmt:"2"},{"char":"3",fmt:"3"},{"char":"4",fmt:"4"},{"char":"5",fmt:"5"},{"char":"6",fmt:"6"},{"char":"7",fmt:"7"},{"char":"8",fmt:"8"},{"char":"9",fmt:"9"},{"char":"β",fmt:":"},{"char":"＜",fmt:"<"},{"char":"＝",fmt:"="},{"char":"＞",fmt:">"},{"char":"α",fmt:"?"},{"char":"A",fmt:"A"},{"char":"B",fmt:"B"},{"char":"C",fmt:"C"},{"char":"D",fmt:"D"},{"char":"E",fmt:"E"},{"char":"F",fmt:"F"},{"char":"G",fmt:"G"},{"char":"H",fmt:"H"},{"char":"I",fmt:"I"},{"char":"J",fmt:"J"},{"char":"K",fmt:"K"},{"char":"L",fmt:"L"},{"char":"M",fmt:"M"},{"char":"N",fmt:"N"},{"char":"O",fmt:"O"},{"char":"P",fmt:"P"},{"char":"Q",fmt:"Q"},{"char":"R",fmt:"R"},{"char":"S",fmt:"S"},{"char":"T",fmt:"T"},{"char":"U",fmt:"U"},{"char":"V",fmt:"V"},{"char":"W",fmt:"W"},{"char":"X",fmt:"X"},{"char":"Y",fmt:"Y"},{"char":"Z",fmt:"Z"},{"char":"[",fmt:"["},{"char":"]",fmt:"]"},{"char":"a",fmt:"a"},{"char":"b",fmt:"b"},{"char":"c",fmt:"c"},{"char":"d",fmt:"d"},{"char":"e",fmt:"e"},{"char":"f",fmt:"f"},{"char":"g",fmt:"g"},{"char":"h",fmt:"h"},{"char":"i",fmt:"i"},{"char":"j",fmt:"j"},{"char":"k",fmt:"k"},{"char":"l",fmt:"l"},{"char":"m",fmt:"m"},{"char":"n",fmt:"n"},{"char":"o",fmt:"o"},{"char":"p",fmt:"p"},{"char":"q",fmt:"q"},{"char":"r",fmt:"r"},{"char":"s",fmt:"s"},{"char":"t",fmt:"t"},{"char":"u",fmt:"u"},{"char":"v",fmt:"v"},{"char":"w",fmt:"w"},{"char":"x",fmt:"x"},{"char":"y",fmt:"y"},{"char":"z",fmt:"z"},{"char":"{",fmt:"{"},{"char":"}",fmt:"}"},{"char":"γ",fmt:"~"}],NfCharcter.charcter_max_bottom_height={},NfCharcter.char_list=function(){return this._char_list||(this._char_list=this._info_table.map(function(v){return v.char
}))},NfCharcter.fmt_list=function(){return this._fmt_list||(this._fmt_list=this._info_table.map(function(v){return v.fmt}))},NfCharcter.fmt_to_char=function(fmt){var info,_i,_len,_ref1;for(_ref1=this._info_table,_i=0,_len=_ref1.length;_len>_i;_i++)if(info=_ref1[_i],info.fmt===fmt)return info.char;return fmt},NfCharcter.char_to_fmt=function(char){var info,_i,_len,_ref1;for(_ref1=this._info_table,_i=0,_len=_ref1.length;_len>_i;_i++)if(info=_ref1[_i],info.char===char)return info.fmt;return""},NfCharcter.build=function(dc,name){return new NfCharcter(dc,name)},NfCharcter.prototype.map_charcter_height=function(){var bottom_height,fontsize,info,met,_i,_len,_ref1,_results;if(fontsize=this.get_font_height(),!NfCharcter.charcter_max_bottom_height[fontsize]){for(NfCharcter.charcter_max_bottom_height[fontsize]=0,_ref1=NfCharcter._info_table,_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)info=_ref1[_i],met=NfCharcter.getLetterMetrics(info.char,1.25*this.get_font_height(),this.get_font_height(),this.my_dc().get_font()),bottom_height=~~(met.height-(met.ascent-met.from_top)),NfCharcter.charcter_max_bottom_height[fontsize]=0,_results.push(1/0!==bottom_height?NfCharcter.charcter_max_bottom_height[fontsize]<bottom_height?NfCharcter.charcter_max_bottom_height[fontsize]=bottom_height:void 0:void 0);return _results}},NfCharcter.prototype.draw=function(){return this.my_dc().draw_text(this.char,this.get_position().x,this.get_position().y)},NfCharcter.prototype.my_dc=function(){return this.dc.select_fonttype(this.font_type),this.dc.set_font_italic(this.italic),this.dc.reset_font(this),this.dc.set_font_scale(this.get_font_scale()),this.dc},NfCharcter.prototype.calc_size=function(){var a;return this.my_dc(),this.map_charcter_height(),this.size={x:this.my_dc().measure_text(this.char),y:this.get_font_height()},a=NfCharcter.getLetterMetrics(this.char,1.25*this.get_font_height(),this.get_font_height(),this.my_dc().get_font()),this.size={x:this.my_dc().measure_text(this.char),y:this.get_font_height(),top_height:~~(a.ascent-a.from_top),bottom_height:NfCharcter.charcter_max_bottom_height[this.get_font_height()],real_height:a.height}},NfCharcter.prototype.do_layout=function(layout_visitor){var vcenter_y;return this.my_dc(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.set_position(layout_visitor.x(),layout_visitor.get_char_vcenter_y()-this.get_font_height()/2),layout_visitor.move(this.size.x,0)},NfCharcter.prototype.char_vcenter=function(){return this.my_dc(),this.get_font_height()/2},NfCharcter.getLetterMetrics=function(character,bounding_height,ascent,font,bounding_width){var canvas,col,ctx,data,font_height,max_y,min_y,red_channel,row;if("＝"===character)return{height:bounding_height,width:bounding_width,from_top:0,ascent:ascent};for(canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),ctx.font=font,ctx.textBaseline="alphabetic",bounding_width=Math.ceil(ctx.measureText(character).width),bounding_height=Math.ceil(bounding_height),canvas.width=bounding_width,canvas.height=bounding_height,ctx.font=font,ctx.textBaseline="alphabetic",ctx.fillStyle="#ff0000",ctx.fillText(character,0,ascent),data=ctx.getImageData(0,0,bounding_width,bounding_height).data,window.debug_need_measure_img&&(this.measure_img=canvas.toDataURL()),min_y=1/0,row=0;bounding_height>row;){for(col=0;bounding_width>col;){if(red_channel=data[row*bounding_width*4+4*col]){min_y=row,row=1/0;break}col++}row++}for(row=bounding_height-1;row>=0;){for(col=bounding_width-1;col>=0;){if(red_channel=data[row*bounding_width*4+4*col]){max_y=row,row=-1;break}col--}row--}return font_height=max_y-min_y+1,{height:font_height,width:bounding_width,from_top:min_y,ascent:ascent}},NfCharcter}(NfPart),NfCombination=function(_super){function NfCombination(dc){this.dc=dc,NfCombination.__super__.constructor.call(this,this.dc,"C")}return __extends(NfCombination,_super),NfCombination}(NfBothSideContainer),NfContainer=function(_super){function NfContainer(dc){this.dc=dc,NfContainer.__super__.constructor.call(this),this.parts=[],this.eoc=new NfEOC(this.dc),this.eoc.set_parent(this)}return __extends(NfContainer,_super),NfContainer.prototype.get=function(index){return index<this.length()?this.parts[index]:this.eoc},NfContainer.prototype.set_parent=function(parent){return this.parent=parent},NfContainer.prototype.on_change_children=function(){return this.update_children(),this.parent?this.parent.on_change_children():void 0},NfContainer.prototype.insert=function(index,part){return this.parts.splice(index,0,part),part.set_parent(this),this.update_children(),this.parent?this.parent.on_change_children():void 0},NfContainer.prototype.length=function(){return this.parts.length},NfContainer.prototype.is_empty=function(){return 0===this.length()},NfContainer.prototype.push=function(part){return part instanceof NfPart?(this.parts.push(part),part.set_parent(this),this.update_children(),this.parent?(null==this.parent.on_change_children&&console.log("err"),this.parent.on_change_children()):void 0):void(window._debug===!0&&console.log("require part instanceof NfPart"))},NfContainer.prototype.remove=function(index){return this.parts.splice(index,1),this.update_children(),this.parent?this.parent.on_change_children():void 0},NfContainer.prototype.insert_array=function(index,arr){var i,v,_i,_len;for(i=_i=0,_len=arr.length;_len>_i;i=++_i)v=arr[i],this.parts.splice(index+i,0,v);return this.update_children()},NfContainer.prototype.carret_part=function(){var part,_i,_len,_ref1;for(_ref1=this.parts,_i=0,_len=_ref1.length;_len>_i;_i++)return part=_ref1[_i],part instanceof NfCharcter?part:part.carret_part();return this.eoc},NfContainer.prototype.update_children=function(){var cnt,part,_i,_len,_ref1;for(cnt=0,_ref1=this.parts,_i=0,_len=_ref1.length;_len>_i;_i++)part=_ref1[_i],part.set_index(cnt),cnt+=1;return this.eoc.index=cnt},NfContainer.prototype.draw=function(){var part,_i,_len,_ref1,_results;if(0===this.parts.length)return this.eoc.draw();for(_ref1=this.parts,_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)part=_ref1[_i],_results.push(part.draw());return _results},NfContainer.prototype.get_parts_from_position=function(x,y){var i,next_x,part,_i,_len,_ref1;if(this.is_include(x,y))for(_ref1=this.parts,i=_i=0,_len=_ref1.length;_len>_i;i=++_i){if(part=_ref1[i],next_x=i+1<this.parts.length?this.parts[i+1].get_position().x:this.size.x,part instanceof NfMultiContainer&&part.is_include(x,y))return part.get_parts_from_position(x,y);if(0===i&&x<part.get_position().x+2*part.size.x/3)return this.parts[0];if(part.get_position().x<=x&&next_x>=x)return part.get_position().x+2*part.size.x/3<x?this.parts[i+1]:this.parts[i]}return this.parts.length>0&&(x<this.get_position().x||x<this.parts[0].x)?this.parts[0]:this.eoc},NfContainer.prototype.get_range_parts=function(first,last){var ar,i,_i;for(ar=[],i=_i=first;last>=first?last>=_i:_i>=last;i=last>=first?++_i:--_i)i<this.parts.length&&ar.push(this.parts[i]);return ar},NfContainer.prototype.calc_size=function(){var bottom_height,char_vcenter,cnt,part,sz,top_height,x,y,_i,_j,_len,_len1,_ref1,_ref2;if(this.parts.length>0){for(_ref1=this.parts,_i=0,_len=_ref1.length;_len>_i;_i++)part=_ref1[_i],part.calc_size();for(char_vcenter=this.char_vcenter(),x=y=bottom_height=top_height=0,cnt=0,_ref2=this.parts,_j=0,_len1=_ref2.length;_len1>_j;_j++)part=_ref2[_j],sz=part.get_size_with_char_vcenter(char_vcenter),x+=sz.x,y=y>sz.y?y:sz.y,null!=sz.bottom_height&&(bottom_height=bottom_height>sz.bottom_height?bottom_height:sz.bottom_height),null!=sz.top_height&&(top_height=top_height>sz.bottom_height?top_height:sz.top_height);return this.size.x=x,this.size.y=y,this.size.bottom_height=bottom_height,this.size.top_height=top_height,this.eoc.calc_size()}return this.eoc.calc_size(),this.size.x=this.eoc.size.x,this.size.y=this.eoc.size.y,this.size.bottom_height=0,this.size.top_height=0},NfContainer.prototype.char_vcenter=function(){var i,part,ret,_i,_len,_ref1;if(this.parts.length>0){for(ret=0,_ref1=this.parts,i=_i=0,_len=_ref1.length;_len>_i;i=++_i)part=_ref1[i],ret=Math.max(ret,part.char_vcenter());return ret}return this.eoc.char_vcenter()},NfContainer.prototype.do_layout=function(layout_visitor){var char_vcenter,part,_i,_len,_ref1;for(this.calc_size(),this.set_position(layout_visitor.x(),layout_visitor.y()),char_vcenter=this.char_vcenter(),_ref1=this.parts,_i=0,_len=_ref1.length;_len>_i;_i++)part=_ref1[_i],layout_visitor.set_char_vcenter(char_vcenter),this.dc.draw_line_color(layout_visitor.x(),layout_visitor.y(),layout_visitor.x(),layout_visitor.y()+char_vcenter,"#000000"),part.do_layout(layout_visitor);return this.eoc.do_layout(layout_visitor)},NfContainer}(NfPart),NfEOC=function(_super){function NfEOC(dc){this.dc=dc,NfEOC.__super__.constructor.apply(this,arguments),this.size={x:0,y:0}}var carret_margin,margin;return __extends(NfEOC,_super),margin=2,carret_margin=2,NfEOC.prototype.calc_size=function(){return this.dc.select_fonttype(DC.ALNUM_FONT),this.dc.set_font_italic(!1),this.dc.reset_font(this),this.dc.set_font_scale(this.get_font_scale()),this.size=0!==this.index?{x:0,y:this.prev().size.y}:{x:this.dc.measure_char(this),y:this.get_font_height()},this.size.x=Math.max(this.size.x,10),this.size.y=Math.max(this.size.y,10)},NfEOC.prototype.char_vcenter=function(){return this.get_font_height()/2},NfEOC.prototype.do_layout=function(layout_visitor){return this.set_position(layout_visitor.x(),layout_visitor.y()),0!==this.index?this.carret_info={x:layout_visitor.x(),y:this.prev().get_position().y,height:this.prev().size.y}:(this.carret_info={x:layout_visitor.x()+margin+carret_margin,y:layout_visitor.y()+margin,height:this.size.y-2},layout_visitor.move_x(this.size.x))},NfEOC.prototype.draw=function(){return"MathWIM.Disp"===this.canvas_type()?1:(this.dc.set_line_dash([2]),this.dc.draw_rect_color(this.get_position().x+margin,this.get_position().y+margin,this.size.x-2*margin,this.size.y-2*margin,ConstColor.EMPTY_CONTAINER),this.dc.set_line_dash([0]))},NfEOC}(NfPart),NfFraction=function(_super){function NfFraction(dc){this.dc=dc,NfFraction.__super__.constructor.call(this),this.top_container=new NfContainer(this.dc),this.bottom_container=new NfContainer(this.dc),this.set_inner_container(this.bottom_container,this.top_container),this.set_inner_container_sorted_for_build(this.top_container,this.bottom_container)}return __extends(NfFraction,_super),NfFraction.prototype.get_top_container=function(){return this.top_container},NfFraction.prototype.get_bottom_container=function(){return this.bottom_container},NfFraction.prototype.get_up_container=function(part){return part===this.bottom_container?this.top_container:void 0},NfFraction.prototype.get_down_container=function(part){return part===this.top_container?this.bottom_container:void 0},NfFraction.prototype.get_parts_from_position=function(x,y){return y<this.line_y?this.top_container.get_parts_from_position(x,y):this.bottom_container.get_parts_from_position(x,y)},NfFraction.prototype.draw=function(){return this.top_container.draw(),this.dc.draw_line(this.line_x,this.line_y,this.line_x+this.line_w,this.line_y),this.bottom_container.draw(),this.draw_focus_box()},NfFraction.prototype.calc_size=function(){var sz1,sz2;return this.top_container.calc_size(),sz1=this.top_container.size,this.bottom_container.calc_size(),sz2=this.bottom_container.size,this.size.x=Math.max(sz1.x,sz2.x)+this.dc.measure_char(this)/2,this.size.y=sz1.y+sz1.bottom_height+sz2.y+sz2.bottom_height+3,this._char_vcenter=sz1.y+sz1.bottom_height+3},NfFraction.prototype.get_size_with_char_vcenter=function(char_vcenter){return{x:this.size.x,y:this.size.y+char_vcenter-this.char_vcenter()}},NfFraction.prototype.char_vcenter=function(){return this.top_container.size.y+this.top_container.size.bottom_height},NfFraction.prototype.do_layout=function(layout_visitor){var char_vcenter,pos,top;return this.calc_size(),pos=layout_visitor.get_position(),char_vcenter=layout_visitor.get_char_vcenter(),top=pos.y+char_vcenter-(this.top_container.size.y+this.top_container.size.bottom_height),this.set_position(layout_visitor.x(),top),layout_visitor.move_x(this.size.x/2-this.top_container.size.x/2),layout_visitor.set_y(top),layout_visitor.set_char_vcenter(0),this.top_container.do_layout(layout_visitor),this.line_x=pos.x,this.line_y=pos.y+char_vcenter,layout_visitor.set(pos.x+this.size.x/2-this.bottom_container.size.x/2,this.line_y+2),layout_visitor.set_char_vcenter(0),this.bottom_container.do_layout(layout_visitor),this.line_w=this.size.x,layout_visitor.set(this.get_position().x+this.size.x,pos.y)},NfFraction}(NfMultiContainer),NfIntegral=function(_super){function NfIntegral(dc){this.dc=dc,NfIntegral.__super__.constructor.call(this),this.top_container=new NfContainer(this.dc),this.bottom_container=new NfContainer(this.dc),this.right_container=new NfContainer(this.dc),this.set_inner_container(this.bottom_container,this.top_container,this.right_container),this.set_inner_container_sorted_for_build(this.top_container,this.bottom_container,this.right_container),this._integral=new NfCharcter(this.dc,"∫"),this._integral.set_parent(this)}return __extends(NfIntegral,_super),NfIntegral.prototype.draw=function(){return this._integral.draw(),this.top_container.draw(),this.bottom_container.draw(),this.right_container.draw(),this.draw_focus_box()},NfIntegral.prototype.char_vcenter=function(){return this.right_container.size.y<this._integral.size.y?this._ymin+this._integral.char_vcenter():this._ymin+this.right_container.char_vcenter()},NfIntegral.prototype.calc_size=function(){var bot_x,top_x,ymax;return this._integral.set_font_scale(2*this.get_font_scale()),this._integral.calc_size(),this.top_container.set_font_scale(.65*this.get_font_scale()),this.top_container.calc_size(),this.bottom_container.set_font_scale(.65*this.get_font_scale()),this.bottom_container.calc_size(),this.right_container.calc_size(),top_x=this.top_container.is_empty()?0:this._integral.size.x+this.top_container.size.x+this._integral.size.x/8,bot_x=this.bottom_container.is_empty()?0:this.bottom_container.size.x+this._integral.size.x/2+this._integral.size.x/8,this.size.x=Math.max(top_x,bot_x,this._integral.size.x)+this.right_container.size.x,ymax=Math.max(this._integral.size.y+this.get_font_height()/4,this.top_container.size.y-this.top_container.char_vcenter(),this.right_container.size.y),this._ymin=-Math.min(0,this._integral.size.y-this.bottom_container.size.y,-this.top_container.char_vcenter()),this.size.y=this._ymin+ymax+2,this.size.bottom_height=this.right_container.size.bottom_height},NfIntegral.prototype.do_layout=function(layout_visitor){var bot_next_x,pos,this_center_y,top_next_x,vcenter,vcenter_y;return this.calc_size(),pos=layout_visitor.get_position(),vcenter=layout_visitor.get_char_vcenter(),vcenter_y=layout_visitor.get_char_vcenter_y(),this_center_y=vcenter_y+(this.char_vcenter()-vcenter),this.set_position(layout_visitor.x(),this_center_y-this.char_vcenter()),this._integral.do_layout(layout_visitor),layout_visitor.set_y(this_center_y-(this.char_vcenter()-this._ymin)-this.top_container.char_vcenter()),layout_visitor.set_char_vcenter(0),layout_visitor.move_x(this._integral.size.x/8),this.top_container.do_layout(layout_visitor),top_next_x=layout_visitor.get_position().x,this.top_container.is_empty()&&(top_next_x=pos.x+this._integral.size.x),layout_visitor.set_x(pos.x+this._integral.size.x/2+this._integral.size.x/8),layout_visitor.set_y(this._integral.get_position().y+this._integral.size.y-this.bottom_container.size.y+this.get_font_height()/4),layout_visitor.set_char_vcenter(0),this.bottom_container.do_layout(layout_visitor),bot_next_x=layout_visitor.get_position().x,this.bottom_container.is_empty()&&(bot_next_x=pos.x+this._integral.size.x),layout_visitor.set_x(Math.max(bot_next_x,top_next_x)),layout_visitor.set_y(vcenter_y-this.right_container.size.y/2),layout_visitor.set_char_vcenter(0),this.right_container.do_layout(layout_visitor),layout_visitor.set_x(pos.x+this.size.x),layout_visitor.set_y(pos.y)},NfIntegral.prototype.get_parts_from_position=function(x,y){return this.right_container.get_position().y<y?this.bottom_container.get_position().y<y?this.right_container.get_position().x<x?this.right_container.get_parts_from_position(x,y):this.bottom_container.get_parts_from_position(x,y):this.right_container.get_parts_from_position(x,y):this.top_container.get_parts_from_position(x,y)},NfIntegral.prototype.get_up_container=function(part){return part===this.bottom_container||part===this.right_container?this.top_container:void 0},NfIntegral.prototype.get_down_container=function(part){return part===this.top_container||part===this.right_container?this.bottom_container:void 0},NfIntegral}(NfMultiContainer),NfLimit=function(_super){function NfLimit(dc){var ar,c,_i,_len;for(this.dc=dc,NfLimit.__super__.constructor.call(this),this.bottom_container=new NfContainer(this.dc),this.right_container=new NfContainer(this.dc),this.set_inner_container(this.bottom_container,this.right_container),this.set_inner_container_sorted_for_build(this.bottom_container,this.right_container),this.lim_symbol=new NfContainer(this.dc),this.lim_symbol.set_parent(this),ar="lim".split(""),_i=0,_len=ar.length;_len>_i;_i++)c=ar[_i],c=new NfCharcter(this.dc,c),c.italic=!1,this.lim_symbol.push(c)}return __extends(NfLimit,_super),NfLimit.prototype.draw=function(){return this.lim_symbol.draw(),this.bottom_container.draw(),this.right_container.draw(),this.draw_focus_box()},NfLimit.prototype.char_vcenter=function(){return-this.top_from_vcenter},NfLimit.prototype.calc_size=function(){var sc;return sc=.6*this.get_font_scale(),this.bottom_container.set_font_scale(9<this.dc.get_font_size()*sc?sc:9/this.dc.get_font_size()),this.lim_symbol.calc_size(),this.bottom_container.calc_size(),this.right_container.calc_size(),this.hcenter_lim_bottom=Math.max(this.lim_symbol.size.x,this.bottom_container.size.x)/2,this._right_container_left=Math.max(this.lim_symbol.size.x,this.bottom_container.size.x),this.size.x=this._right_container_left+this.right_container.size.x,this.lim_vcenter=this.lim_symbol.char_vcenter(),this.top_from_vcenter=Math.min(-this.lim_vcenter,-this.right_container.char_vcenter()),this.bottom_from_vcenter=Math.max(this.lim_symbol.size.y+this.bottom_container.size.y-this.lim_vcenter,this.right_container.size.y-this.right_container.char_vcenter()),this.size.y=this.bottom_from_vcenter-this.top_from_vcenter,this.size.bottom_height=this.bottom_container.size.bottom_height},NfLimit.prototype.do_layout=function(layout_visitor){var pos,vcenter_y;return pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.set_position(layout_visitor.x(),vcenter_y+this.top_from_vcenter),layout_visitor.set_x(pos.x+this.hcenter_lim_bottom-this.lim_symbol.size.x/2),layout_visitor.set_y(vcenter_y-this.lim_symbol.char_vcenter()),this.lim_symbol.do_layout(layout_visitor),layout_visitor.set_x(pos.x+this.hcenter_lim_bottom-this.bottom_container.size.x/2),layout_visitor.set_y(this.lim_symbol.get_position().y+this.lim_symbol.size.y),this.bottom_container.do_layout(layout_visitor),layout_visitor.set_x(pos.x+this._right_container_left),layout_visitor.set_y(vcenter_y-this.right_container.char_vcenter()),layout_visitor.set_char_vcenter(0),this.right_container.do_layout(layout_visitor),layout_visitor.set_y(pos.y),layout_visitor.set_x(pos.x+this.size.x)},NfLimit.prototype.get_parts_from_position=function(x,y){return this.right_container.get_position().x-10<x&&y<this.bottom_container.get_position().y?this.right_container.get_parts_from_position(x,y):this.bottom_container.get_parts_from_position(x,y)},NfLimit.prototype.get_up_container=function(part){return part===this.bottom_container?this.right_container:void 0},NfLimit.prototype.get_down_container=function(part){return part===this.right_container?this.bottom_container:void 0},NfLimit}(NfMultiContainer),NfLogarithm=function(_super){function NfLogarithm(dc){var ar,c,_i,_len;for(this.dc=dc,NfLogarithm.__super__.constructor.call(this),this.right_container1=new NfContainer(this.dc),this.right_container2=new NfContainer(this.dc),this.set_inner_container(this.right_container1,this.right_container2),this.set_inner_container_sorted_for_build(this.right_container1,this.right_container2),this.log_symbol=new NfContainer(this.dc),this.log_symbol.set_parent(this),ar="log".split(""),_i=0,_len=ar.length;_len>_i;_i++)c=ar[_i],c=new NfCharcter(this.dc,c),c.italic=!1,this.log_symbol.push(c)}return __extends(NfLogarithm,_super),NfLogarithm.prototype.draw=function(){return this.right_container1.draw(),this.right_container2.draw(),this.log_symbol.draw(),this.draw_focus_box()},NfLogarithm.prototype.char_vcenter=function(){return this.right_container2.char_vcenter()},NfLogarithm.prototype.calc_size=function(){var sc;return sc=.6*this.get_font_scale(),this.right_container1.set_font_scale(9<this.dc.get_font_size()*sc?sc:9/this.dc.get_font_size()),this.right_container1.calc_size(),this.right_container1.calc_size(),this.right_container2.calc_size(),this.log_symbol.calc_size(),this._top_of_container_from_vcenter=this.get_font_height()/8,this._right_container1_size_y_from_vcenter=this._top_of_container_from_vcenter+this.right_container1.size.y,this.size.x=this.log_symbol.size.x+this.right_container1.size.x+this.right_container2.size.x,this.size.y=Math.max(this.log_symbol.size.y,this.char_vcenter()+this._right_container1_size_y_from_vcenter,this.right_container2.size.y),this.size.bottom_height=Math.max(this.log_symbol.size.bottom_height,this.right_container1.size.bottom_height,this.right_container2.size.bottom_height)},NfLogarithm.prototype.do_layout=function(layout_visitor){var pos,vcenter_y;return pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.set_position(layout_visitor.x(),vcenter_y-this.char_vcenter()),layout_visitor.set_y(vcenter_y-this.log_symbol.char_vcenter()),this.log_symbol.do_layout(layout_visitor),layout_visitor.set_y(vcenter_y+this._top_of_container_from_vcenter),layout_visitor.set_char_vcenter(0),this.right_container1.do_layout(layout_visitor),layout_visitor.set_y(vcenter_y-this.right_container2.char_vcenter()),this.right_container2.do_layout(layout_visitor),layout_visitor.set_x(pos.x+this.size.x),layout_visitor.set_y(pos.y)},NfLogarithm.prototype.get_parts_from_position=function(x,y){return this.right_container2.get_position().x<x?this.right_container2.get_parts_from_position(x,y):this.right_container1.get_parts_from_position(x,y)},NfLogarithm.prototype.get_up_container=function(part){return part===this.right_container1?this.right_container2:void 0},NfLogarithm.prototype.get_down_container=function(part){return part===this.right_container2?this.right_container1:void 0},NfLogarithm}(NfMultiContainer),NfMain=function(_super){function NfMain(ex_calc_canvas){this.ex_calc_canvas=ex_calc_canvas,NfMain.__super__.constructor.call(this,this.ex_calc_canvas.dc)}return __extends(NfMain,_super),NfMain.prototype.do_layout=function(){var layout_visitor;return this.calc_size(),layout_visitor=new LayoutVisitor,null!=this.ex_calc_canvas.height&&layout_visitor.set_y(this.ex_calc_canvas.height/2-this.size.y/2),NfMain.__super__.do_layout.call(this,layout_visitor)},NfMain.prototype.calc_size=function(){return NfMain.__super__.calc_size.apply(this,arguments),this.size.y=this.size.y+~~this.size.bottom_height},NfMain.prototype.get_font_height=function(){return this.dc.get_font_height()},NfMain.prototype.get_font_size=function(){return this.dc.get_font_size()},NfMain.prototype.get_font_scale=function(){return 1},NfMain.prototype.update_children=function(){return NfMain.__super__.update_children.call(this),this.do_layout()},NfMain.prototype.main_part=function(){return this},NfMain}(NfContainer),NfProbability=function(_super){function NfProbability(dc){this.dc=dc,NfProbability.__super__.constructor.call(this,this.dc,"P")}return __extends(NfProbability,_super),NfProbability}(NfBothSideContainer),NfRemainderSetContainer=function(_super){function NfRemainderSetContainer(dc){this.dc=dc,NfRemainderSetContainer.__super__.constructor.call(this),this.container=new NfContainer(this.dc),this.set_inner_container(this.container),this.set_inner_container_sorted_for_build(this.container)}return __extends(NfRemainderSetContainer,_super),NfRemainderSetContainer.prototype.draw=function(){var pos,x,x_to,y;return this.container.draw(),pos=this.get_position(),x=Math.ceil(pos.x)+1,y=Math.ceil(pos.y),x_to=x+this.container.size.x,this.dc.set_line_width(1),this.dc.draw_line_color(x,y+this.yajirusi_h/2,x_to,y+this.yajirusi_h/2,"#000000"),this.draw_focus_box()},NfRemainderSetContainer.prototype.char_vcenter=function(){return this.container.char_vcenter()+this.yajirusi_h/2},NfRemainderSetContainer.prototype.calc_size=function(){return this.container.calc_size(),this.yajirusi_h=Math.ceil(this.get_font_height()/3),this.yajirusi_h%2!==1&&this.yajirusi_h+1,this.size.x=this.container.size.x+2,this.size.y=this.container.size.y+this.yajirusi_h/2,this.size.bottom_height=this.container.size.bottom_height},NfRemainderSetContainer.prototype.do_layout=function(layout_visitor){var pos,vcenter_y;return this.calc_size(),pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.set_position(layout_visitor.x(),vcenter_y-this.char_vcenter()),layout_visitor.move_x(1),layout_visitor.set_y(vcenter_y-this.container.char_vcenter()),layout_visitor.set_char_vcenter(0),this.container.do_layout(layout_visitor),layout_visitor.set_y(pos.y),layout_visitor.move_x(1)},NfRemainderSetContainer.prototype.get_parts_from_position=function(x,y){return this.container.get_parts_from_position(x,y)},NfRemainderSetContainer}(NfMultiContainer),NfRepeatedCombination=function(_super){function NfRepeatedCombination(dc){this.dc=dc,NfRepeatedCombination.__super__.constructor.call(this,this.dc,"H")}return __extends(NfRepeatedCombination,_super),NfRepeatedCombination}(NfBothSideContainer),NfRoot=function(_super){function NfRoot(dc){this.dc=dc,NfRoot.__super__.constructor.call(this),this.left_container=new NfContainer(this.dc),this.right_container=new NfContainer(this.dc),this.set_inner_container(this.left_container,this.right_container),this.set_inner_container_sorted_for_build(this.right_container,this.left_container)}var max;return __extends(NfRoot,_super),NfRoot.prototype.draw=function(){var c,i,pos,_i,_len,_ref1;for(this.right_container.draw(),this.left_container.draw(),pos=this.get_position(),_ref1=this.hige.path,i=_i=0,_len=_ref1.length;_len>_i;i=++_i)c=_ref1[i],0!==i&&(this.dc.set_line_width(2===i?2:1),this.dc.draw_line(pos.x+this.hige.path[i-1].x,this.wd_char_center+this.hige.path[i-1].y,pos.x+c.x,this.wd_char_center+c.y));return this.draw_focus_box()},NfRoot.prototype.char_vcenter=function(){return this._vcenter-this._top},max=function(a,b){return b>a?b:a},NfRoot.prototype._left_size=function(){return max(this.left_container.size.x+9,6+this.char_w)},NfRoot.prototype._calc_hige=function(){var h,l,path,y0,y1;return path=[],l=this._left_size(),y0=7,y1=16,h=this.get_font_height(),path[0]={x:this._hige_left-this._left,y:this._vcenter+h/5},path[1]={x:this._hige_left+3-this._left,y:this._vcenter+h/12},path[2]={x:this._hige_left+3+3-this._left,y:this._bottom},path[3]={x:this._x_center-this._left,y:this._rtop2},path[4]={x:this.size.x,y:path[3].y},this.hige={path:path}},NfRoot.prototype.get_parts_from_position=function(x,y){return x<this.right_container.get_position().x?this.left_container.get_parts_from_position(x,y):this.right_container.get_parts_from_position(x,y)},NfRoot.prototype.calc_size=function(){var sc;return sc=.6*this.get_font_scale(),this.left_container.set_font_scale(9<this.dc.get_font_size()*sc?sc:9/this.dc.get_font_size()),this.right_container.calc_size(),this.left_container.calc_size(),this._bottom=this.right_container.size.y-this.right_container.char_vcenter(),this._vcenter=0,this._rtop=-this.right_container.char_vcenter(),this._rtop2=this._rtop,this._rtop3=this._rtop2-2,this._ltop=-this.left_container.size.y-1,this._top=Math.min(this._rtop3,this._ltop),this._x_center=0,this._char_w=this.dc.measure_char(this),this._hige_left=-this._char_w-3-3,this._lright=-this.dc.measure_char(this.left_container),this._lleft=this._lright-this.left_container.size.x,this._left=Math.min(this._hige_left,this._lleft),this._rleft=this._x_center+1,this._rright=this._rleft+this.right_container.size.x,this.size.x=this._rright-this._left,this.size.y=this._bottom-this._top,this.size.bottom_height=this.right_container.size.bottom_height,this._calc_hige()},NfRoot.prototype.do_layout=function(layout_visitor){var pos,top;return this.calc_size(),pos=layout_visitor.get_position(),this._layout_vcenter=layout_visitor.get_char_vcenter(),this.wd_char_center=pos.y+this._layout_vcenter,this.diff=this._layout_vcenter-this._vcenter,top=this.diff+this._top,this.set_position(layout_visitor.x(),pos.y+this._layout_vcenter+this._top),layout_visitor.move_x(this._lleft-this._left),layout_visitor.set_y(this.wd_char_center+this._ltop),layout_visitor.set_char_vcenter(0),this.left_container.do_layout(layout_visitor),layout_visitor.set_y(this.wd_char_center+this._rtop),layout_visitor.set_x(pos.x+this._rleft-this._left),layout_visitor.set_char_vcenter(0),this.right_container.do_layout(layout_visitor),layout_visitor.set(pos.x+this.size.x,pos.y)},NfRoot}(NfMultiContainer),NfSigma=function(_super){function NfSigma(dc){this.dc=dc,NfSigma.__super__.constructor.call(this),this.top_container=new NfContainer(this.dc),this.bottom_container=new NfContainer(this.dc),this.right_container=new NfContainer(this.dc),this.set_inner_container(this.top_container,this.bottom_container,this.right_container),this.set_inner_container_sorted_for_build(this.top_container,this.bottom_container,this.right_container),this.sigma_symbol=new NfCharcter(this.dc,"Σ"),this.sigma_symbol.set_parent(this)}return __extends(NfSigma,_super),NfSigma.prototype.draw=function(){return this.sigma_symbol.draw(),this.top_container.draw(),this.bottom_container.draw(),this.right_container.draw(),this.draw_focus_box()},NfSigma.prototype.char_vcenter=function(){return this.top_container.size.y+this.sigma_symbol.char_vcenter()},NfSigma.prototype.calc_size=function(){return this.sigma_symbol.set_font_scale(1.25*this.get_font_scale()),this.sigma_symbol.calc_size(),this.top_container.set_font_scale(.65*this.get_font_scale()),this.top_container.calc_size(),this.bottom_container.set_font_scale(.65*this.get_font_scale()),this.bottom_container.calc_size(),this.right_container.calc_size(),this.max_left_size=Math.max(Math.max(this.sigma_symbol.size.x,this.top_container.size.x),this.bottom_container.size.x),this.top_left=-(this.top_container.size.x/2),this.bottom_left=-(this.bottom_container.size.x/2),this.simbol_left=-(this.sigma_symbol.size.x/2),this.size.x=Math.max(this.max_left_size,this.max_left_size/2+this.sigma_symbol.size.x/2+this.right_container.size.x),this.size.y=this.sigma_symbol.size.y+this.top_container.size.y+this.bottom_container.size.y,this.size.bottom_height=this.bottom_container.size.bottom_height},NfSigma.prototype.do_layout=function(layout_visitor){var left_center,pos,vcenter,vcenter_y;return this.calc_size(),pos=layout_visitor.get_position(),vcenter=layout_visitor.get_char_vcenter(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.set_position(layout_visitor.x(),vcenter_y-this.size.y/2),left_center=pos.x+this.max_left_size/2,layout_visitor.set_x(left_center+this.simbol_left),this.sigma_symbol.do_layout(layout_visitor),layout_visitor.set_x(left_center+this.top_left),layout_visitor.set_y(this.sigma_symbol.get_position().y-this.top_container.size.y),layout_visitor.set_char_vcenter(0),this.top_container.do_layout(layout_visitor),layout_visitor.set_x(left_center+this.bottom_left),layout_visitor.set_y(this.sigma_symbol.get_position().y+this.sigma_symbol.size.y),layout_visitor.set_char_vcenter(0),this.bottom_container.do_layout(layout_visitor),layout_visitor.set_x(this.sigma_symbol.get_position().x+this.sigma_symbol.size.x),layout_visitor.set_y(vcenter_y-this.right_container.size.y/2),layout_visitor.set_char_vcenter(0),this.right_container.do_layout(layout_visitor),layout_visitor.set_x(pos.x+this.size.x),layout_visitor.set_y(pos.y)
},NfSigma.prototype.get_parts_from_position=function(x,y){return this.right_container.get_position().x<x?this.right_container.get_parts_from_position(x,y):y<this.sigma_symbol.get_position().y+this.sigma_symbol.size.y/2?this.top_container.get_parts_from_position(x,y):this.bottom_container.get_parts_from_position(x,y)},NfSigma.prototype.get_up_container=function(part){return part===this.bottom_container||part===this.right_container?this.top_container:void 0},NfSigma.prototype.get_down_container=function(part){return part===this.top_container||part===this.right_container?this.bottom_container:void 0},NfSigma}(NfMultiContainer),NfUpperBottomFormula=function(_super){function NfUpperBottomFormula(dc){this.dc=dc,NfUpperBottomFormula.__super__.constructor.call(this),this.upper=new NfContainer(this.dc),this.bottom=new NfContainer(this.dc),this.set_inner_container(this.upper,this.bottom),this.set_inner_container_sorted_for_build(this.upper,this.bottom)}return __extends(NfUpperBottomFormula,_super),NfUpperBottomFormula.prototype.draw=function(){return this.upper.draw(),this.bottom.draw(),this.draw_focus_box()},NfUpperBottomFormula.prototype.char_vcenter=function(){return this.upper.size.y},NfUpperBottomFormula.prototype.calc_size=function(){var bottom_size,sc,upper_size;return sc=.6*this.get_font_scale(),9<this.dc.get_font_size()*sc?(this.upper.set_font_scale(sc),this.bottom.set_font_scale(sc)):(this.upper.set_font_scale(9/this.dc.get_font_size()),this.bottom.set_font_scale(9/this.dc.get_font_size())),this.upper.calc_size(),this.size.x=this.upper.size.x,this.size.y=this.get_font_height()/2+this.upper.size.y,this.size.bottom_height=0,this.bottom.calc_size(),this._top_of_bottom=0,this.size.x=Math.max(this.upper.size.x,this.bottom.size.x),upper_size=Math.max(this.upper.size.y+this.upper.size.bottom_height,this.get_font_height()/2),bottom_size=Math.max(this._top_of_bottom+this.bottom.size.y,this.get_font_height()/2),this.size.y=upper_size+bottom_size,this.size.bottom_height=this.bottom.size.bottom_height},NfUpperBottomFormula.prototype.do_layout=function(layout_visitor){var height,pos,vcenter_y;return this.calc_size(),pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),height=this.upper.size.y+this.upper.size.bottom_height,this.set_position(layout_visitor.x(),vcenter_y-height),layout_visitor.set_y(vcenter_y-height),layout_visitor.set_char_vcenter(0),this.upper.do_layout(layout_visitor),layout_visitor.set_y(vcenter_y+this._top_of_bottom),layout_visitor.set_x(pos.x),layout_visitor.set_char_vcenter(0),this.bottom.do_layout(layout_visitor),layout_visitor.set_y(pos.y),layout_visitor.set_x(pos.x+this.size.x)},NfUpperBottomFormula.prototype.get_parts_from_position=function(x,y){return y<this.bottom.get_position().y?this.upper.get_parts_from_position(x,y):this.bottom.get_parts_from_position(x,y)},NfUpperBottomFormula.prototype.get_up_container=function(part){return part===this.bottom?this.upper:void 0},NfUpperBottomFormula.prototype.get_down_container=function(part){return part===this.upper?this.bottom:void 0},NfUpperBottomFormula}(NfMultiContainer),NfUpperFormula=function(_super){function NfUpperFormula(dc){this.dc=dc,NfUpperFormula.__super__.constructor.call(this),this.upper=new NfContainer(this.dc),this.set_inner_container(this.upper),this.set_inner_container_sorted_for_build(this.upper)}return __extends(NfUpperFormula,_super),NfUpperFormula.prototype.draw=function(){return this.upper.draw(),this.draw_focus_box()},NfUpperFormula.prototype.char_vcenter=function(){return this.has_fraction()?this.size.y-this.get_font_height()/2:this.upper.size.y},NfUpperFormula.prototype.has_fraction=function(){return this.get_font_height()<this.upper.size.y},NfUpperFormula.prototype.calc_size=function(){var sc;return sc=.6*this.get_font_scale(),this.upper.set_font_scale(9<this.dc.get_font_size()*sc?sc:9/this.dc.get_font_size()),this.upper.calc_size(),this.size.x=this.upper.size.x,this.size.y=this.has_fraction()?1+this.upper.size.y:this.get_font_height()/2+this.upper.size.y,this.size.bottom_height=0},NfUpperFormula.prototype.do_layout=function(layout_visitor){var height,pos,vcenter_y;return this.calc_size(),pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.has_fraction()&&(vcenter_y+=this.get_font_height()/2+1),height=this.upper.size.y+this.upper.size.bottom_height,this.set_position(layout_visitor.x(),vcenter_y-height),layout_visitor.set_y(vcenter_y-height),layout_visitor.set_char_vcenter(0),this.upper.do_layout(layout_visitor),layout_visitor.set_y(pos.y)},NfUpperFormula.prototype.get_parts_from_position=function(x,y){return this.upper.get_parts_from_position(x,y)},NfUpperFormula}(NfMultiContainer),NfVector=function(_super){function NfVector(dc){this.dc=dc,NfVector.__super__.constructor.call(this),this.container=new NfContainer(this.dc),this.set_inner_container(this.container),this.set_inner_container_sorted_for_build(this.container)}return __extends(NfVector,_super),NfVector.prototype.draw=function(){var pos,x,x_to,y;return this.container.draw(),pos=this.get_position(),x=Math.ceil(pos.x)+1,y=Math.ceil(pos.y),x_to=x+this.container.size.x,this.dc.set_line_width(1),this.dc.draw_line_color(x,y+Math.ceil(this.yajirusi_h/2)-.5,x_to,y+Math.ceil(this.yajirusi_h/2)-.5,"#000000"),this.dc.fill_path4(x_to,y+Math.ceil(this.yajirusi_h/2)-.5,x_to-this.yajirusi_w,y-.5,x_to-Math.ceil(this.yajirusi_w/2),y+Math.ceil(this.yajirusi_h/2)-.5,x_to-this.yajirusi_w,y+this.yajirusi_h-.5),this.draw_focus_box()},NfVector.prototype.char_vcenter=function(){return this.container.char_vcenter()+this.yajirusi_h/2},NfVector.prototype.calc_size=function(){return this.container.calc_size(),this.yajirusi_h=Math.ceil(this.get_font_height()/3),this.yajirusi_h%2!==1&&this.yajirusi_h+1,this.yajirusi_w=Math.ceil(this.dc.measure_char(this)/3*2),this.size.x=this.container.size.x+2,this.size.y=this.container.size.y+this.yajirusi_h/2,this.size.bottom_height=this.container.size.bottom_height},NfVector.prototype.do_layout=function(layout_visitor){var pos,vcenter_y;return this.calc_size(),pos=layout_visitor.get_position(),vcenter_y=layout_visitor.get_char_vcenter_y(),this.set_position(layout_visitor.x(),vcenter_y-this.char_vcenter()),layout_visitor.move_x(1),layout_visitor.set_y(vcenter_y-this.container.char_vcenter()),layout_visitor.set_char_vcenter(0),this.container.do_layout(layout_visitor),layout_visitor.set_y(pos.y),layout_visitor.move_x(1)},NfVector.prototype.get_parts_from_position=function(x,y){return this.container.get_parts_from_position(x,y)},NfVector}(NfMultiContainer),Action=function(){function Action(){}return Action.prototype.run=function(){},Action}(),AcCyclic=function(_super){function AcCyclic(ex_canvas,chars){this.ex_canvas=ex_canvas,this.chars=chars}return __extends(AcCyclic,_super),AcCyclic.input_state="cancel",AcCyclic.cancel_input=function(){return this.input_state="cancel"},AcCyclic.is_active_input=function(){return"active"===AcCyclic.input_state},AcCyclic.active_input=function(){return this.input_state="active"},AcCyclic.prototype.run=function(){var c,i,idx,prev,_i,_len,_ref1;if(!AcCyclic.is_active_input())return this.ex_canvas.do_action(new AcInsert(this.ex_canvas,new NfCharcter(this.ex_canvas.dc,this.chars[0]))),AcCyclic.active_input();if(!(prev=this.ex_canvas.carret.get_prev_part()))return this.ex_canvas.do_action(new AcInsert(this.ex_canvas,new NfCharcter(this.ex_canvas.dc,this.chars[0])));for(_ref1=this.chars,i=_i=0,_len=_ref1.length;_len>_i;i=++_i)if(c=_ref1[i],prev.char===c)return this.ex_canvas.do_action(new AcDelete(this.ex_canvas,AcDelete.BACKSPACE)),idx=i+1===this.chars.length?0:i+1,void this.ex_canvas.do_action(new AcInsert(this.ex_canvas,new NfCharcter(this.ex_canvas.dc,this.chars[idx])))},AcCyclic}(Action),AcDelete=function(_super){function AcDelete(ex_canvas,type){switch(this.ex_canvas=ex_canvas,this.carret=this.ex_canvas.carret,type){case AcDelete.BACKSPACE:this.part=this.carret.get_part().prev();break;case AcDelete.DELETE:this.part=this.carret.get_part()}}return __extends(AcDelete,_super),AcDelete.BACKSPACE=1,AcDelete.DELETE=2,AcDelete.prototype.run=function(){var n,_ref1;return null!=(null!=(_ref1=this.part)?_ref1.next():void 0)?(n=this.part.next(),this.part["delete"](),this.carret.move_to(n)):void 0},AcDelete}(Action),AcInsert=function(_super){function AcInsert(ex_canvas,pt){this.ex_canvas=ex_canvas,this.pt=pt,this.carret=this.ex_canvas.carret}return __extends(AcInsert,_super),AcInsert.prototype.run=function(){var pt;return pt=this.carret.get_part(),pt.parent.insert(pt.index,this.pt),this.carret.move_to(this.pt.next())},AcInsert}(Action),HtmlKeyboard.keyboard_html='<style type="text/css">\ndiv._keyboard_key {\n	-moz-box-shadow:inset 0px 1px 0px 0px #ffffff;\n	-webkit-box-shadow:inset 0px 1px 0px 0px #ffffff;\n	box-shadow:inset 0px 1px 0px 0px #ffffff;\n	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #f9f9f9), color-stop(1, #e9e9e9) );\n	background:-moz-linear-gradient( center top, #f9f9f9 5%, #e9e9e9 100% );\n	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#f9f9f9\', endColorstr=\'#e9e9e9\');\n	background-color:#f9f9f9;\n	-webkit-border-top-left-radius:5px;\n	-moz-border-radius-topleft:5px;\n	border-top-left-radius:5px;\n	-webkit-border-top-right-radius:5px;\n	-moz-border-radius-topright:5px;\n	border-top-right-radius:5px;\n	-webkit-border-bottom-right-radius:5px;\n	-moz-border-radius-bottomright:5px;\n	border-bottom-right-radius:5px;\n	-webkit-border-bottom-left-radius:5px;\n	-moz-border-radius-bottomleft:5px;\n	border-bottom-left-radius:5px;\n	text-indent:0px;\n	border:0px solid #dcdcdc;\n	display:inline-block;\n	color:#666666;\n	font-family:"MS UI Gothic", "Hiragino Kaku Gothic ProN", "Droid Sans Japanese", "sans-serif";\n	font-size:<%=$key_font_size%>px;\n	font-weight:normal;\n	font-style:normal;\n	height:40px;\n	line-height:1.45cm;\n	width:40px;\n	text-decoration:none;\n	text-align:center;\n	vertical-align:middle;\n	text-shadow:1px 1px 0px #ffffff;\n	cursor:pointer;\n	-moz-user-select: none;\n	-khtml-user-select: none;\n	-webkit-user-select: none;\n}\ndiv._keyboard_key.userhover  {\n	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #e9e9e9), color-stop(1, #f9f9f9) );\n	background:-moz-linear-gradient( center top, #e9e9e9 5%, #f9f9f9 100% );\n	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#e9e9e9\', endColorstr=\'#f9f9f9\');\n	background-color:#e9e9e9;\n}\ndiv._keyboard_key:active  {\n	position:relative;\n	top:1px;\n}\ndiv._keyboard_key.useractive {\n	position:relative;\n	top:1px;\n}\n\n._keyboard_all_bk {\n	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #e0ffff), color-stop(1, #afeeee) );\n	background:-moz-linear-gradient( center top, #e0ffff 5%, #afeeee 100% );\n	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#e0ffff\', endColorstr=\'#afeeee\');\n	background-color:#e0ffff;\n	-webkit-border-top-left-radius:5px;\n	-moz-border-radius-topleft:5px;\n	border-top-left-radius:5px;\n	-webkit-border-top-right-radius:5px;\n	-moz-border-radius-topright:5px;\n	border-top-right-radius:5px;\n	-webkit-border-bottom-right-radius:5px;\n	-moz-border-radius-bottomright:5px;\n	border-bottom-right-radius:5px;\n	-webkit-border-bottom-left-radius:5px;\n	-moz-border-radius-bottomleft:5px;\n	border-bottom-left-radius:5px;\n}\n._keyboard_bk {\n  background-color: transparent;\n}\n._keyboard_table_td {\n  padding: 2 2;\n}\n\ndiv[data-key-type="alpha"] {\n  font-family: "Times New Roman", "SERIF";\n  font-style: italic;\n  \n}\ndiv[data-key-type="number"] {\n  font-family: "Times New Roman", "SERIF";\n}\ndiv[data-key-type="other"] {\n	font-family:"MS UI Gothic", "Hiragino Kaku Gothic ProN", "Droid Sans Japanese", "sans-serif";\n  \n}\n\ndiv[data-key-type="empty"] {\n  font-family: "Times New Roman", "SERIF";\n}\n\ndiv[data-key-type="mpfont"] {\n  font-family: "mplus_symbol", "SERIF";\n}\n\ndiv[data-key-type="integral"] {\n  font-family: "integral-symbol", "SERIF";\n}\n\ndiv[data-key-type="sigma"] {\n  font-family: "sigma-symbol", "SERIF";\n}\n\ndiv[data-key-type="root"] {\n  font-family: "root-symbol", "SERIF";\n}\n\n\ndiv._key_change_button {\n	-moz-box-shadow:inset 0px 1px 0px 0px #c1ed9c;\n	-webkit-box-shadow:inset 0px 1px 0px 0px #c1ed9c;\n	box-shadow:inset 0px 1px 0px 0px #c1ed9c;\n	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #9dce2c), color-stop(1, #8cb82b) );\n	background:-moz-linear-gradient( center top, #9dce2c 5%, #8cb82b 100% );\n	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#9dce2c\', endColorstr=\'#8cb82b\');\n	background-color:#9dce2c;\n	-webkit-border-top-left-radius:5px;\n	-moz-border-radius-topleft:5px;\n	border-top-left-radius:5px;\n	-webkit-border-top-right-radius:5px;\n	-moz-border-radius-topright:5px;\n	border-top-right-radius:5px;\n	-webkit-border-bottom-right-radius:5px;\n	-moz-border-radius-bottomright:5px;\n	border-bottom-right-radius:5px;\n	-webkit-border-bottom-left-radius:5px;\n	-moz-border-radius-bottomleft:5px;\n	border-bottom-left-radius:5px;\n	text-indent:0;\n	border:1px solid #83c41a;\n	display:inline-block;\n	color:#ffffff;\n	font-family:Arial;\n	font-size:18px;\n	font-weight:bold;\n	font-style:normal;\n	height:0.725cm;\n	line-height:0.725cm;\n	width:62px;\n	text-decoration:none;\n	text-align:center;\n	text-shadow:1px 1px 0px #689324;\n	cursor:pointer;\n	-moz-user-select: none;\n	-khtml-user-select: none;\n	-webkit-user-select: none;\n}\ndiv._key_change_button.userhover {\n	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #8cb82b), color-stop(1, #9dce2c) );\n	background:-moz-linear-gradient( center top, #8cb82b 5%, #9dce2c 100% );\n	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#8cb82b\', endColorstr=\'#9dce2c\');\n	background-color:#8cb82b;\n}\ndiv._key_change_button:active {\n	position:relative;\n	top:1px;\n}\ndiv._key_change_button.useractive {\n	position:relative;\n	top:1px;\n}\n</style>\n\n  <div id="_keyboard">\n      <div class="_keyboard_page" id="_keyboard_high1" style="visibility:hidden; display:none;">\n      <table class="_keyboard_table _keyboard_all_bk" style="table-layout:fixed; width:4.85cm">\n      <!-- キーボードナビ -->\n      <tr class="_keyboard_table_tr_navi _keyboard_bk" style="table-layout:fixed; width:1.45cm; height=1.45cm">\n        <td class="_keyboard_table_td _keyboard_bk"><div id="_keyboard_high1.prev" class="_key_change_button" style="width:1.45cm;"> 前 </div></td>\n        <td class="_keyboard_table_td _keyboard_bk"></td>\n        <td class="_keyboard_table_td _keyboard_bk"><div id="_keyboard_high1.next" class="_key_change_button" style="width:1.45cm;"> 次 </div></td>\n      </tr>\n      \n      <!-- このページのボタン -->\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key1" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">1</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key2" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">2</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key3" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">3</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key4" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">4</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key5" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">5</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key6" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">6</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key7" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">7</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key8" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">8</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key9" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">9</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key." data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">.</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key0" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">0</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key," data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">,</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key＋" style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  font-family:\'MS UI Gothic\', \'Hiragino Kaku Gothic ProN\', \'Droid Sans Japanese\', \'sans-serif\';">＋</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key－" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">－</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key×" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">×</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key÷" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">÷</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key±" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">±</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key＝" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">＝</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key＜" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">＜</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key分数" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.58cm; font-weight: bold;">分数</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key累乗" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.58cm; font-weight: bold;">累乗</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key＞" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">＞</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key√" data-key-type=root style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">√</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key( )" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">( )</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key≦" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">≦</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key左" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">←</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key右" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">→</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key≧" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">≧</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyBS" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">BS</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyDel" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">Del</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n      </table>\n    </div>\n\n      <div class="_keyboard_page" id="_keyboard_high2" style="visibility:hidden; display:none;">\n      <table class="_keyboard_table _keyboard_all_bk" style="table-layout:fixed; width:4.85cm">\n      <!-- キーボードナビ -->\n      <tr class="_keyboard_table_tr_navi _keyboard_bk" style="table-layout:fixed; width:1.45cm; height=1.45cm">\n        <td class="_keyboard_table_td _keyboard_bk"><div id="_keyboard_high2.prev" class="_key_change_button" style="width:1.45cm;"> 前 </div></td>\n        <td class="_keyboard_table_td _keyboard_bk"></td>\n        <td class="_keyboard_table_td _keyboard_bk"><div id="_keyboard_high2.next" class="_key_change_button" style="width:1.45cm;"> 次 </div></td>\n      </tr>\n      \n      <!-- このページのボタン -->\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keya" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">a</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyb" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">b</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyc" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">c</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyd" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">d</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keye" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">e</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyf" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">f</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyg" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">g</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyh" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">h</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyi" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">i</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyj" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">j</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyk" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">k</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyl" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">l</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keym" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">m</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyn" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">n</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyo" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">o</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyp" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">p</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyq" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">q</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyr" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">r</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keys" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">s</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyt" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">t</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyu" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">u</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyv" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">v</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyw" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">w</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyx" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">x</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyy" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">y</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyz" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">z</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key大" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold; font-style: italic;">A/a</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyπ" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">π</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyBS" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">BS</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyDel" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">Del</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n      </table>\n    </div>\n\n      <div class="_keyboard_page" id="_keyboard_high3" style="visibility:hidden; display:none;">\n      <table class="_keyboard_table _keyboard_all_bk" style="table-layout:fixed; width:4.85cm">\n      <!-- キーボードナビ -->\n      <tr class="_keyboard_table_tr_navi _keyboard_bk" style="table-layout:fixed; width:1.45cm; height=1.45cm">\n        <td class="_keyboard_table_td _keyboard_bk"><div id="_keyboard_high3.prev" class="_key_change_button" style="width:1.45cm;"> 前 </div></td>\n        <td class="_keyboard_table_td _keyboard_bk"></td>\n        <td class="_keyboard_table_td _keyboard_bk"><div id="_keyboard_high3.next" class="_key_change_button" style="width:1.45cm;"> 次 </div></td>\n      </tr>\n      \n      <!-- このページのボタン -->\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keysin" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">sin</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keycos" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">cos</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keytan" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">tan</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key_P_" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">_P_</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key_C_" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">_C_</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key!" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">!</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key絶対値" data-key-type=other style="width:3.01cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">絶対値</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div style="height:1.45cm;width:1.45cm;"></div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keylog" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">log</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyベクトル" data-key-type=other style="width:3.01cm; height:1.45cm; font-size: 0.58cm; font-weight: bold;">ベクトル</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div style="height:1.45cm;width:1.45cm;"></div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key下付" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.58cm; font-weight: bold;">下付</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keylim" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">lim</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key∫" data-key-type=integral style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">∫</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyΣ" data-key-type=sigma style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">Σ</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key余集合" data-key-type=other style="width:3.01cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">余集合</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div style="height:1.45cm;width:1.45cm;"></div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key∅" data-key-type=empty style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">∅</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key∈" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">∈</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key∋" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">∋</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyα" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">α</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key⊂" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">⊂</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key⊃" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">⊃</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyβ" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">β</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key∩" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">∩</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key∪" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">∪</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyγ" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">γ</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyσ" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">σ</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyBS" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">BS</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyDel" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">Del</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n      </table>\n    </div>\n\n      <div class="_keyboard_page" id="_keyboard_high4" style="visibility:hidden; display:none;">\n      <table class="_keyboard_table _keyboard_all_bk" style="table-layout:fixed; width:4.85cm">\n      <!-- キーボードナビ -->\n      <tr class="_keyboard_table_tr_navi _keyboard_bk" style="table-layout:fixed; width:1.45cm; height=1.45cm">\n        <td class="_keyboard_table_td _keyboard_bk"><div id="_keyboard_high4.prev" class="_key_change_button" style="width:1.45cm;"> 前 </div></td>\n        <td class="_keyboard_table_td _keyboard_bk"></td>\n        <td class="_keyboard_table_td _keyboard_bk"><div id="_keyboard_high4.next" class="_key_change_button" style="width:1.45cm;"> 次 </div></td>\n      </tr>\n      \n      <!-- このページのボタン -->\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key•" data-key-type=number style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">•</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key´" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">´</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyΔ" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">Δ</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key_H_" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">_H_</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key→" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">→</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key∞" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">∞</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key⊥" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">⊥</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyﾟ" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">ﾟ</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key≡" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">≡</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key∥" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">∥</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key∽" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">∽</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key△" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">△</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key∠" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">∠</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key：" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">：</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key≠" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">≠</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_key≒" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">≒</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyθ" data-key-type=alpha style="width:1.45cm; height:1.45cm; font-size: 1.305cm;  ">θ</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n              \n            \n            </td>\n          \n          </tr>\n      \n          <tr  class="_keyboard_table_tr_key _keyboard_bk" style="table-layout:fixed; width:1.65cm; height:1.55cm">\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div style="height:1.45cm;width:1.45cm;"></div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyBS" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">BS</div>\n              \n            \n            </td>\n          \n            <td class="_keyboard_table_td">\n            \n                \n              \n                <div class="_keyboard_key" id="_keyDel" data-key-type=other style="width:1.45cm; height:1.45cm; font-size: 0.725cm; font-weight: bold;">Del</div>\n              \n            \n            </td>\n          \n          </tr>\n      \n      </table>\n    </div>\n\n  </div>\n'
}).call(this);